<!doctype html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="ru">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css?family=Work+Sans:500,600" rel="stylesheet">
  
    <title>Odoo Guidelines &#8212; Документация odoo 13.0</title>
    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/patchqueue.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script type="text/javascript" src="../_static/jquery.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap.js"></script>
    <script type="text/javascript" src="../_static/doc.js"></script>
    <script type="text/javascript" src="../_static/jquery.noconflict.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <script type="text/javascript" src="../_static/patchqueue.js"></script><link rel="canonical" href="" />
  
    <link rel="index" title="Алфавитный указатель" href="../genindex.html" />
    <link rel="search" title="Поиск" href="../search.html" />
    <link rel="next" title="Mobile JavaScript" href="mobile.html" />
    <link rel="prev" title="Mixins and Useful Classes" href="mixins.html" /> 
  </head><body><header class="o_main_header o_has_sub_nav o_inverted ">
    <div class="o_main_header_main">
      <a class="pull-left o_logo" href="/"></a>
      <a href="#" class="o_mobile_menu_toggle visible-xs-block pull-right">
        <span class="sr-only">Toggle navigation</span>
        <span class="mdi-navigation-menu"></span>
      </a>
      <div class="o_header_buttons">
        <a href="http://www.odoo.com/trial" class="btn btn-primary">Start Now</a>
      </div>
      <ul class="o_primary_nav">
        <li class="dropdown">
          <a href="#" class="dropdown-toggle">Apps</a>
          <div class="dropdown-menu o_secondary_nav">
            <div class="container">
              <div class="row">
                <div class="col-sm-3 o_website_apps">
                  <div class="o_nav_app_family">
                    <span></span> Websites
                    <div>Build great user experience</div>
                  </div>
                  <ul>
                    <li><a href="https://www.odoo.com/page/website-builder">Website Builder</a></li>
                    <li><a href="https://www.odoo.com/page/e-commerce">eCommerce</a></li>
                    <li><a href="https://www.odoo.com/page/blog-engine">Blogs</a></li>
                    <li><a href="https://www.odoo.com/page/community-builder">Forums</a></li>
                    <li><a href="https://www.odoo.com/page/slides">Slides</a></li>
                    <li><a href="https://adspike.odoo.com">SEA</a></li>
                  </ul>
                </div>
                <div class="col-sm-3 o_sale_apps">
                  <div class="o_nav_app_family">
                    <span></span> Sales
                    <div>Boost your success rate</div>
                  </div>
                  <ul>
                    <li><a href="https://www.odoo.com/page/sales">Sales</a></li>
                    <li><a href="https://www.odoo.com/page/crm">CRM</a></li>
                    <li><a href="https://www.odoo.com/page/billing">Invoicing</a></li>
                    <li class="dropdown">
                      <a href="#0" class="dropdown-toggle">Point of Sale</a>
                      <ul>
                        <li><a href="https://www.odoo.com/page/point-of-sale">Shops</a></li>
                        <li><a href="https://www.odoo.com/page/pos-restaurant">Restaurants</a></li>
                      </ul>
                    </li>
                    <li><a href="https://www.odoo.com/page/subscriptions">Subscriptions</a></li>
                    <li><a href="https://www.odoo.com/page/sign">Sign</a></li>
                  </ul>
                </div>
                <div class="col-sm-3 o_operation_apps">
                  <div class="o_nav_app_family">
                    <span></span> Operations
                    <div>It's all about efficiency</div>
                  </div>
                  <ul>
                    <li><a href="https://www.odoo.com/page/accounting">Accounting</a></li>
                    <li><a href="https://www.odoo.com/page/project-management">Project</a></li>
                    <li class="dropdown">
                      <a href="#0" class="dropdown-toggle">Human Resources</a>
                      <ul>
                        <li><a href="https://www.odoo.com/page/recruitment">Recruitment</a></li>
                        <li><a href="https://www.odoo.com/page/employees">Employees</a></li>
                        <li><a href="https://www.odoo.com/page/expenses">Expenses</a></li>
                        <li><a href="https://www.odoo.com/page/appraisal">Appraisal</a></li>
                        <li><a href="https://www.odoo.com/page/fleet">Fleet</a></li>
                        <li><a href="https://www.odoo.com/page/leaves">Leaves</a></li>
                      </ul>
                    </li>
                    <li><a href="https://www.odoo.com/page/warehouse">Inventory</a></li>
                    <li><a href="https://www.odoo.com/page/purchase">Purchase</a></li>
                    <li class="dropdown">
                      <a href="#0" class="dropdown-toggle">Manufacturing</a>
                      <ul>
                        <li><a href="https://www.odoo.com/page/manufacturing">MRP</a></li>
                        <li><a href="https://www.odoo.com/page/plm">PLM</a></li>
                        <li><a href="https://www.odoo.com/page/maintenance">Maintenance</a></li>
                        <li><a href="https://www.odoo.com/page/quality">Quality</a></li>
                      </ul>
                    </li>
                  </ul>
                </div>
                <div class="col-sm-3 o_productivity_apps">
                  <div class="o_nav_app_family">
                    <span></span> Productivity Tools
                    <div>Great Tools = Happy People</div>
                  </div>
                  <ul>
                    <li class="dropdown">
                      <a href="#0" class="dropdown-toggle">Communication</a>
                      <ul>
                        <li><a href="https://www.odoo.com/page/discuss">Discuss</a></li>
                        <li><a href="https://www.odoo.com/page/discuss-groups">Mailing Lists</a></li>
                        <li><a href="https://www.odoo.com/page/notes">Notes</a></li>
                        <li><a href="#">Help desk</a></li>
                        <li><a href="#">Appointment</a></li>
                      </ul>
                    </li>
                    <li><a href="https://www.odoo.com/page/timesheet">Timesheet</a></li>
                    <li><a href="https://www.odoo.com/page/email-marketing">Email Marketing</a></li>
                    <li><a href="https://www.odoo.com/page/events">Events</a></li>
                    <li><a href="https://www.odoo.com/page/survey">Survey</a></li>
                    <li><a href="https://www.odoo.com/page/live-chat">Live Chat</a></li>
                  </ul>
                </div>
              </div>
            </div>
            <a href="http://www.odoo.com/apps/modules" class="o_store_link"><i class="fa fa-cube fa-fw"></i> Third party apps</a>
          </div>
        </li>
        <li><a href="https://www.odoo.com/page/tour">Tour</a></li>
        <li><a href="https://www.odoo.com/pricing">Pricing</a></li>
        <li><a href="https://www.odoo.com/page/docs">Docs</a></li>
      </ul>
    </div>
    <nav class="navbar o_sub_nav">
      <div class="container">
        <div class="navbar-header visible-xs">
            <button type="button" class="navbar-toggle collapsed text-left btn-block" data-toggle="collapse" data-target="#o_sub-menu" aria-expanded="false">
              Navigate
              <span class="mdi-hardware-keyboard-arrow-down pull-right"></span>
            </button>
        </div>

        <div class="collapse navbar-collapse" id="o_sub-menu">
          <ol class="o_breadcrumb breadcrumb nav navbar-left">
              
              





    
        
            <li><a href="../index.html">Developer Doc</a></li>
        
    
    <li class="active"><a href="#">Odoo Guidelines</a></li>

              
          </ol>

          <div class="call-to-action navbar-right hidden-xs">
            <a href="http://www.odoo.com/trial" class="btn btn-primary">Start Now</a>
          </div>

          <ul class="navbar-nav navbar-right nav o_sub_nav_actions">
            
              <li class="divider"></li>
            

            
            


            
          </ul>

          <ul class="nav navbar-nav navbar-right">
            

            
            

<li><a href="https://www.odoo.com/documentation/user/13.0/index.html">User</a></li>
<li><a href="https://www.odoo.com/documentation/13.0/index.html">Developer</a></li>
<li><a href="https://www.odoo.com/documentation/13.0/setup/install.html">Installation</a></li>
<li><a href="https://odoo.com/slides">eLearning</a></li>
<li><a href="https://www.odoo.com/page/odoo-white-paper">White Papers</a></li>
<li><a href="https://www.odoo.com/page/legal">Legal</a></li>
            

            
          </ul>
        </div>
      </div>
    </nav>
  </header><div id="wrap" class="">
    
    
    
    <figure class="card top has_banner">
      <span class="card-img" style="background-image: url('../_static/banners/odoo_guideline.jpg');"></span>
      <div class="container text-center">
        <h1> Odoo Guidelines </h1>
      </div>
    </figure>
    
    
    
      <main class="container ">
        
        <div class="o_content row">
          
          <aside>
            <div class="navbar-aside text-center">
              <ul class="nav text-left list-group"><li class="list-group-item"><a href="#module-structure" class="reference ripple internal">Module structure</a><ul ><li class="list-group-item"><a href="#directories" class="reference ripple internal">Directories</a></li><li class="list-group-item"><a href="#file-naming" class="reference ripple internal">File naming</a></li></ul></li><li class="list-group-item"><a href="#xml-files" class="reference ripple internal">XML files</a><ul ><li class="list-group-item"><a href="#format" class="reference ripple internal">Format</a></li><li class="list-group-item"><a href="#xml-ids-and-naming" class="reference ripple internal">XML IDs and naming</a><ul ><li class="list-group-item"><a href="#security-view-and-action" class="reference ripple internal">Security, View and Action</a></li><li class="list-group-item"><a href="#inheriting-xml" class="reference ripple internal">Inheriting XML</a></li></ul></li></ul></li><li class="list-group-item"><a href="#python" class="reference ripple internal">Python</a><ul ><li class="list-group-item"><a href="#pep8-options" class="reference ripple internal">PEP8 options</a></li><li class="list-group-item"><a href="#imports" class="reference ripple internal">Imports</a></li><li class="list-group-item"><a href="#idiomatics-of-programming-python" class="reference ripple internal">Idiomatics of Programming (Python)</a></li><li class="list-group-item"><a href="#programming-in-odoo" class="reference ripple internal">Programming in Odoo</a><ul ><li class="list-group-item"><a href="#make-your-method-work-in-batch" class="reference ripple internal">Make your method work in batch</a></li><li class="list-group-item"><a href="#propagate-the-context" class="reference ripple internal">Propagate the context</a></li><li class="list-group-item"><a href="#do-not-bypass-the-orm" class="reference ripple internal">Do not bypass the ORM</a></li><li class="list-group-item"><a href="#no-sql-injections-please" class="reference ripple internal">No SQL injections, please !</a></li><li class="list-group-item"><a href="#think-extendable" class="reference ripple internal">Think extendable</a></li><li class="list-group-item"><a href="#never-commit-the-transaction" class="reference ripple internal">Never commit the transaction</a></li><li class="list-group-item"><a href="#use-translation-method-correctly" class="reference ripple internal">Use translation method correctly</a></li></ul></li><li class="list-group-item"><a href="#symbols-and-conventions" class="reference ripple internal">Symbols and Conventions</a></li></ul></li><li class="list-group-item"><a href="#javascript-and-css" class="reference ripple internal">Javascript and CSS</a><ul ><li class="list-group-item"><a href="#static-files-organization" class="reference ripple internal">Static files organization</a></li><li class="list-group-item"><a href="#javascript-coding-guidelines" class="reference ripple internal">Javascript coding guidelines</a></li><li class="list-group-item"><a href="#css-coding-guidelines" class="reference ripple internal">CSS coding guidelines</a></li></ul></li><li class="list-group-item"><a href="#git" class="reference ripple internal">Git</a><ul ><li class="list-group-item"><a href="#configure-your-git" class="reference ripple internal">Configure your git</a></li><li class="list-group-item"><a href="#commit-message-structure" class="reference ripple internal">Commit message structure</a></li><li class="list-group-item"><a href="#tag-and-module-name" class="reference ripple internal">Tag and module name</a></li><li class="list-group-item"><a href="#commit-message-header" class="reference ripple internal">Commit message header</a></li><li class="list-group-item"><a href="#commit-message-full-description" class="reference ripple internal">Commit message full description</a></li></ul></li></ul>
              
              <p class="gith-container"><a href="https://github.com/odoo/odoo/edit/13.0/doc/reference/guidelines.rst" class="gith-link">
                  Edit on GitHub
              </a></p>
              
            </div>
          </aside>
          
          <article class="doc-body ">
            
            
  <section id="odoo-guidelines"><i id="reference-guidelines"></i><p >This page introduces the Odoo Coding Guidelines. Those aim to improve the
quality of Odoo Apps code. Indeed proper code improves readability, eases
maintenance, helps debugging, lowers complexity and promotes reliability.
These guidelines should be applied to every new module and to all new development.</p><div role="alert" class="alert-warning alert"><h3 class="alert-title">Предупреждение</h3><p >When modifying existing files in <strong >stable version</strong> the original file style
strictly supersedes any other style guidelines. In other words please never
modify existing files in order to apply these guidelines. It avoids disrupting
the revision history of code lines. Diff should be kept minimal. For more
details, see our <a href="https://odoo.com/submit-pr" class="reference external alert-link">pull request guide</a>.</p></div><div role="alert" class="alert-warning alert"><h3 class="alert-title">Предупреждение</h3><p >When modifying existing files in <strong >master (development) version</strong> apply those
guidelines to existing code only for modified code or if most of the file is
under revision. In other words modify existing files structure only if it is
going under major changes. In that case first do a <strong >move</strong> commit then apply
the changes related to the feature.</p></div></section><section id="module-structure"><h2 >Module structure</h2></section><section id="directories"><h3 >Directories</h3><p >A module is organized in important directories. Those contain the business logic;
having a look at them should make you understand the purpose of the module.</p><ul ><li ><em >data/</em> : demo and data xml</li><li ><em >models/</em> : models definition</li><li ><em >controllers/</em> : contains controllers (HTTP routes)</li><li ><em >views/</em> : contains the views and templates</li><li ><em >static/</em> : contains the web assets, separated into <em >css/, js/, img/, lib/, …</em></li></ul><p >Other optional directories compose the module.</p><ul ><li ><em >wizard/</em> : regroups the transient models (<code >models.TransientModel</code>) and their views</li><li ><em >report/</em> : contains the printable reports and models based on SQL views. Python objects and XML views are included in this directory</li><li ><em >tests/</em> : contains the Python tests</li></ul></section><section id="file-naming"><h3 >File naming</h3><p >File naming is important to quickly find information through all odoo addons.
This section explains how to name files in a standard odoo module. As an
example we use a <a href="https://github.com/tivisse/odoodays-2018/tree/master/plant_nursery" class="reference external">plant nursery</a> application.
It holds two main models <em >plant.nursery</em> and <em >plant.order</em>.</p><p >Concerning <em >models</em>, split the business logic by sets of models belonging to
a same main model. Each set lies in a given file named based on its main model.
If there is only one model, its name is the same as the module name. Each
inherited model should be in its own file to help understanding of impacted
models.</p><div class="highlight-text"><div class="highlight"><pre><span></span>addons/plant_nursery/
|-- models/
|   |-- plant_nursery.py (first main model)
|   |-- plant_order.py (another main model)
|   |-- res_partner.py (inherited Odoo model)
</pre></div>
</div>
<p >Concerning <em >security</em> and access rights and rules two main files should be used.
First one is the definition of access rights done in a <code >ir.model.access.csv</code>
file. User groups are defined in <code >&lt;module&gt;_groups.xml</code>. Access rules are
defined in <code >&lt;model&gt;_security.xml</code>.</p><div class="highlight-text"><div class="highlight"><pre><span></span>addons/plant_nursery/
|-- security/
|   |-- ir.model.access.csv
|   |-- plant_nusery_groups.xml
|   |-- plant_nusery_security.xml
|   |-- plant_order_security.xml
</pre></div>
</div>
<p >Concerning <em >views</em>, backend views should be split like models and suffixed
by <code >_views.xml</code>. Backend views are list, form, kanban, activity, graph, pivot, ..
views. To ease split by model in views main menus not linked to specific actions
may be extracted into an optional <code >&lt;module&gt;_menus.xml</code> file. Templates (QWeb
pages used notably for portal / website display) and bundles (import of JS and
CSS assets) are put in separate files. Those are respectively
<code >&lt;model&gt;_templates.xml</code> and <code >assets.xml</code> files.</p><div class="highlight-text"><div class="highlight"><pre><span></span>addons/plant_nursery/
|-- views/
|   | -- assets.xml (import of JS / CSS)
|   | -- plant_nursery_menus.xml (optional definition of main menus)
|   | -- plant_nursery_views.xml (backend views)
|   | -- plant_nursery_templates.xml (portal templates)
|   | -- plant_order_views.xml
|   | -- plant_order_templates.xml
|   | -- res_partner_views.xml
</pre></div>
</div>
<p >Concerning <em >data</em>, split them by purpose (demo or data) and main model. Filenames
will be the main_model name suffixed by <code >_demo.xml</code> or <code >_data.xml</code>. For instance
for an application having demo and data for its main model as well as subtypes,
activities and mail templates all related to mail module:</p><div class="highlight-text"><div class="highlight"><pre><span></span>addons/plant_nursery/
|-- data/
|   |-- plant_nursery_data.xml
|   |-- plant_nursery_demo.xml
|   |-- mail_data.xml
</pre></div>
</div>
<p >Concerning <em >controllers</em>, generally all controllers belong to a single controller
contained in a file named <code >&lt;module_name&gt;.py</code>. An old convention in Odoo is to
name this file <code >main.py</code> but it is considered as outdated. If you need to inherit
an existing controller from another module do it in <code >&lt;inherited_module_name&gt;.py</code>.
For example adding portal controller in an application is done in <code >portal.py</code>.</p><div class="highlight-text"><div class="highlight"><pre><span></span>addons/plant_nursery/
|-- controllers/
|   |-- plant_nursery.py
|   |-- portal.py (inheriting portal/controllers/portal.py)
|   |-- main.py (deprecated, replaced by plant_nursery.py)
</pre></div>
</div>
<p >Concerning <em >static files</em>, Javascript files follow globally the same logic as
python models. Each component should be in its own file with a meaningful name.
For instance, the activity widgets are located in <code >activity.js</code> of mail module.
Subdirectories can also be created to structure the „package“ (see web module
for more details). The same logic should be applied for the templates of JS
widgets (static XML files) and for their styles (scss files). Don’t link
data (image, libraries) outside Odoo: do not use an URL to an image but copy
it in the codebase instead.</p><p >Concerning <em >wizards</em>, naming convention is the same of for python models:
<code >&lt;transient&gt;.py</code> and <code >&lt;transient&gt;_views.xml</code>. Both are put in the wizard
directory. This naming comes from old odoo applications using the wizard
keyword for transient models.</p><div class="highlight-text"><div class="highlight"><pre><span></span>addons/plant_nursery/
|-- wizard/
|   |-- make_plant_order.py
|   |-- make_plant_order_views.xml
</pre></div>
</div>
<p >Concerning <em >statistics reports</em> done with python / SQL views and classic views
naming is the following :</p><div class="highlight-text"><div class="highlight"><pre><span></span>addons/plant_nursery/
|-- report/
|   |-- plant_order_report.py
|   |-- plant_order_report_views.xml
</pre></div>
</div>
<p >Concerning <em >printable reports</em> which contain mainly data preparation and Qweb
templates naming is the following :</p><div class="highlight-text"><div class="highlight"><pre><span></span>addons/plant_nursery/
|-- report/
|   |-- plant_order_reports.xml (report actions, paperformat, ...)
|   |-- plant_order_templates.xml (xml report templates)
</pre></div>
</div>
<p >The complete tree of our Odoo module therefore looks like</p><div class="highlight-text"><div class="highlight"><pre><span></span>addons/plant_nursery/
|-- __init__.py
|-- __manifest__.py
|-- controllers/
|   |-- __init__.py
|   |-- plant_nursery.py
|   |-- portal.py
|-- data/
|   |-- plant_nursery_data.xml
|   |-- plant_nursery_demo.xml
|   |-- mail_data.xml
|-- models/
|   |-- __init__.py
|   |-- plant_nursery.py
|   |-- plant_order.py
|   |-- res_partner.py
|-- report/
|   |-- __init__.py
|   |-- plant_order_report.py
|   |-- plant_order_report_views.xml
|   |-- plant_order_reports.xml (report actions, paperformat, ...)
|   |-- plant_order_templates.xml (xml report templates)
|-- security/
|   |-- ir.model.access.csv
|   |-- plant_nusery_groups.xml
|   |-- plant_nusery_security.xml
|   |-- plant_order_security.xml
|-- static/
|   |-- img/
|   |   |-- my_little_kitten.png
|   |   |-- troll.jpg
|   |-- lib/
|   |   |-- external_lib/
|   |-- src/
|   |   |-- js/
|   |   |   |-- widget_a.js
|   |   |   |-- widget_b.js
|   |   |-- scss/
|   |   |   |-- widget_a.scss
|   |   |   |-- widget_b.scss
|   |   |-- xml/
|   |   |   |-- widget_a.xml
|   |   |   |-- widget_a.xml
|-- views/
|   |-- assets.xml
|   |-- plant_nursery_menus.xml
|   |-- plant_nursery_views.xml
|   |-- plant_nursery_templates.xml
|   |-- plant_order_views.xml
|   |-- plant_order_templates.xml
|   |-- res_partner_views.xml
|-- wizard/
|   |--make_plant_order.py
|   |--make_plant_order_views.xml
</pre></div>
</div>
<div role="alert" class="alert-info alert"><h3 class="alert-title">Примечание</h3><p >File names should only contain <code >[a-z0-9_]</code> (lowercase
alphanumerics and <code >_</code>)</p></div><div role="alert" class="alert-warning alert"><h3 class="alert-title">Предупреждение</h3><p >Use correct file permissions : folder 755 and file 644.</p></div></section><section id="xml-files"><i id="reference-guidelines-xml"></i><h2 >XML files</h2></section><section id="format"><h3 >Format</h3><p >To declare a record in XML, the <strong >record</strong> notation (using <em >&lt;record&gt;</em>) is recommended:</p><ul ><li >Place <code >id</code> attribute before <code >model</code></li><li >For field declaration, <code >name</code> attribute is first. Then place the
<em >value</em> either in the <code >field</code> tag, either in the <code >eval</code>
attribute, and finally other attributes (widget, options, …)
ordered by importance.</li><li >Try to group the record by model. In case of dependencies between
action/menu/views, this convention may not be applicable.</li><li >Use naming convention defined at the next point</li><li >The tag <em >&lt;data&gt;</em> is only used to set not-updatable data with <code >noupdate=1</code>.
If there is only not-updatable data in the file, the <code >noupdate=1</code> can be
set on the <code >&lt;odoo&gt;</code> tag and do not set a <code >&lt;data&gt;</code> tag.</li></ul><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;record</span> <span class="na">id=</span><span class="s">&quot;view_id&quot;</span> <span class="na">model=</span><span class="s">&quot;ir.ui.view&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>view.name<span class="nt">&lt;/field&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;model&quot;</span><span class="nt">&gt;</span>object_name<span class="nt">&lt;/field&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;priority&quot;</span> <span class="na">eval=</span><span class="s">&quot;16&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;arch&quot;</span> <span class="na">type=</span><span class="s">&quot;xml&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;tree&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;my_field_1&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;my_field_2&quot;</span> <span class="na">string=</span><span class="s">&quot;My Label&quot;</span> <span class="na">widget=</span><span class="s">&quot;statusbar&quot;</span> <span class="na">statusbar_visible=</span><span class="s">&quot;draft,sent,progress,done&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/tree&gt;</span>
    <span class="nt">&lt;/field&gt;</span>
<span class="nt">&lt;/record&gt;</span>
</pre></div>
</div>
<p >Odoo supports custom tags acting as syntactic sugar:</p><ul ><li >menuitem: use it as a shortcut to declare a <code >ir.ui.menu</code></li><li >template: use it to declare a QWeb View requiring only the <code >arch</code> section of the view.</li><li >report: use to declare a <a href="actions.html#reference-actions-report" class="reference internal"><span class="std-ref std">report action</span></a></li><li >act_window: use it if the record notation can’t do what you want</li></ul><p >The 4 first tags are preferred over the <em >record</em> notation.</p></section><section id="xml-ids-and-naming"><h3 >XML IDs and naming</h3></section><section id="security-view-and-action"><h4 >Security, View and Action</h4><p >Use the following pattern :</p><ul ><li >For a menu: <code class="samp"><em >&lt;model_name&gt;</em>_menu</code>, or <code class="samp"><em >&lt;model_name&gt;</em>_menu_<em >do_stuff</em></code> for submenus.</li><li >For a view: <code class="samp"><em >&lt;model_name&gt;</em>_view_<em >&lt;view_type&gt;</em></code>, where <em >view_type</em> is
<code >kanban</code>, <code >form</code>, <code >tree</code>, <code >search</code>, …</li><li >For an action: the main action respects <code class="samp"><em >&lt;model_name&gt;</em>_action</code>.
Others are suffixed with <code class="samp">_<em >&lt;detail&gt;</em></code>, where <em >detail</em> is a
lowercase string briefly explaining the action. This is used only if
multiple actions are declared for the model.</li><li >For window actions: suffix the action name by the specific view information
like <code class="samp"><em >&lt;model_name&gt;</em>_action_view_<em >&lt;view_type&gt;</em></code>.</li><li >For a group: <code class="samp"><em >&lt;model_name&gt;</em>_group_<em >&lt;group_name&gt;</em></code> where <em >group_name</em>
is the name of the group, generally „user“, „manager“, …</li><li >For a rule: <code class="samp"><em >&lt;model_name&gt;</em>_rule_<em >&lt;concerned_group&gt;</em></code> where
<em >concerned_group</em> is the short name of the concerned group („user“
for the „model_name_group_user“, „public“ for public user, „company“
for multi-company rules, …).</li></ul><p >Name should be identical to xml id with dots replacing underscores. Actions
should have a real naming as it is used as display name.</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="c">&lt;!-- views  --&gt;</span>
<span class="nt">&lt;record</span> <span class="na">id=</span><span class="s">&quot;model_name_view_form&quot;</span> <span class="na">model=</span><span class="s">&quot;ir.ui.view&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>model.name.view.form<span class="nt">&lt;/field&gt;</span>
    ...
<span class="nt">&lt;/record&gt;</span>

<span class="nt">&lt;record</span> <span class="na">id=</span><span class="s">&quot;model_name_view_kanban&quot;</span> <span class="na">model=</span><span class="s">&quot;ir.ui.view&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>model.name.view.kanban<span class="nt">&lt;/field&gt;</span>
    ...
<span class="nt">&lt;/record&gt;</span>

<span class="c">&lt;!-- actions --&gt;</span>
<span class="nt">&lt;record</span> <span class="na">id=</span><span class="s">&quot;model_name_action&quot;</span> <span class="na">model=</span><span class="s">&quot;ir.act.window&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>Model Main Action<span class="nt">&lt;/field&gt;</span>
    ...
<span class="nt">&lt;/record&gt;</span>

<span class="nt">&lt;record</span> <span class="na">id=</span><span class="s">&quot;model_name_action_child_list&quot;</span> <span class="na">model=</span><span class="s">&quot;ir.actions.act_window&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>Model Access Childs<span class="nt">&lt;/field&gt;</span>
<span class="nt">&lt;/record&gt;</span>

<span class="c">&lt;!-- menus and sub-menus --&gt;</span>
<span class="nt">&lt;menuitem</span>
    <span class="na">id=</span><span class="s">&quot;model_name_menu_root&quot;</span>
    <span class="na">name=</span><span class="s">&quot;Main Menu&quot;</span>
    <span class="na">sequence=</span><span class="s">&quot;5&quot;</span>
<span class="nt">/&gt;</span>
<span class="nt">&lt;menuitem</span>
    <span class="na">id=</span><span class="s">&quot;model_name_menu_action&quot;</span>
    <span class="na">name=</span><span class="s">&quot;Sub Menu 1&quot;</span>
    <span class="na">parent=</span><span class="s">&quot;module_name.module_name_menu_root&quot;</span>
    <span class="na">action=</span><span class="s">&quot;model_name_action&quot;</span>
    <span class="na">sequence=</span><span class="s">&quot;10&quot;</span>
<span class="nt">/&gt;</span>

<span class="c">&lt;!-- security --&gt;</span>
<span class="nt">&lt;record</span> <span class="na">id=</span><span class="s">&quot;module_name_group_user&quot;</span> <span class="na">model=</span><span class="s">&quot;res.groups&quot;</span><span class="nt">&gt;</span>
    ...
<span class="nt">&lt;/record&gt;</span>

<span class="nt">&lt;record</span> <span class="na">id=</span><span class="s">&quot;model_name_rule_public&quot;</span> <span class="na">model=</span><span class="s">&quot;ir.rule&quot;</span><span class="nt">&gt;</span>
    ...
<span class="nt">&lt;/record&gt;</span>

<span class="nt">&lt;record</span> <span class="na">id=</span><span class="s">&quot;model_name_rule_company&quot;</span> <span class="na">model=</span><span class="s">&quot;ir.rule&quot;</span><span class="nt">&gt;</span>
    ...
<span class="nt">&lt;/record&gt;</span>
</pre></div>
</div>
</section><section id="inheriting-xml"><h4 >Inheriting XML</h4><p >Xml Ids of inheriting views should use the same ID as the original record.
It helps finding all inheritance at a glance. As final Xml Ids are prefixed
by the module that creates them there is no overlap.</p><p >Naming should contain an <code >.inherit.{details}</code> suffix to ease understanding
the override purpose when looking at its name.</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;record</span> <span class="na">id=</span><span class="s">&quot;model_view_form&quot;</span> <span class="na">model=</span><span class="s">&quot;ir.ui.view&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>model.view.form.inherit.module2<span class="nt">&lt;/field&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;inherit_id&quot;</span> <span class="na">ref=</span><span class="s">&quot;module1.model_view_form&quot;</span><span class="nt">/&gt;</span>
    ...
<span class="nt">&lt;/record&gt;</span>
</pre></div>
</div>
<p >New primary views do not require the inherit suffix as those are new records
based upon the first one.</p><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;record</span> <span class="na">id=</span><span class="s">&quot;module2.model_view_form&quot;</span> <span class="na">model=</span><span class="s">&quot;ir.ui.view&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>model.view.form.module2<span class="nt">&lt;/field&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;inherit_id&quot;</span> <span class="na">ref=</span><span class="s">&quot;module1.model_view_form&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;field</span> <span class="na">name=</span><span class="s">&quot;mode&quot;</span><span class="nt">&gt;</span>primary<span class="nt">&lt;/field&gt;</span>
    ...
<span class="nt">&lt;/record&gt;</span>
</pre></div>
</div>
</section><section id="python"><i id="reference-guidelines-python"></i><h2 >Python</h2></section><section id="pep8-options"><h3 >PEP8 options</h3><p >Using a linter can help show syntax and semantic warnings or errors. Odoo
source code tries to respect Python standard, but some of them can be ignored.</p><ul ><li >E501: line too long</li><li >E301: expected 1 blank line, found 0</li><li >E302: expected 2 blank lines, found 1</li></ul></section><section id="imports"><h3 >Imports</h3><p >The imports are ordered as</p><ol ><li >External libraries (one per line sorted and split in python stdlib)</li><li >Imports of <code >odoo</code></li><li >Imports from Odoo modules (rarely, and only if necessary)</li></ol><p >Inside these 3 groups, the imported lines are alphabetically sorted.</p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># 1 : imports of python lib</span>
<span class="kn">import</span> <span class="nn">base64</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="c1"># 2 : imports of odoo</span>
<span class="kn">import</span> <span class="nn">odoo</span>
<span class="kn">from</span> <span class="nn">odoo</span> <span class="kn">import</span> <span class="n">api</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">models</span><span class="p">,</span> <span class="n">_</span> <span class="c1"># alphabetically ordered</span>
<span class="kn">from</span> <span class="nn">odoo.tools.safe_eval</span> <span class="kn">import</span> <span class="n">safe_eval</span> <span class="k">as</span> <span class="nb">eval</span>
<span class="c1"># 3 : imports from odoo addons</span>
<span class="kn">from</span> <span class="nn">odoo.addons.website.models.website</span> <span class="kn">import</span> <span class="n">slug</span>
<span class="kn">from</span> <span class="nn">odoo.addons.web.controllers.main</span> <span class="kn">import</span> <span class="n">login_redirect</span>
</pre></div>
</div>
</section><section id="idiomatics-of-programming-python"><h3 >Idiomatics of Programming (Python)</h3><ul ><li >Each python file should have <code ># -*- coding: utf-8 -*-</code> as first line.</li><li >Always favor <em >readability</em> over <em >conciseness</em> or using the language features or idioms.</li><li >Don’t use <code >.clone()</code></li></ul><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># bad</span>
<span class="n">new_dict</span> <span class="o">=</span> <span class="n">my_dict</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
<span class="n">new_list</span> <span class="o">=</span> <span class="n">old_list</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
<span class="c1"># good</span>
<span class="n">new_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">my_dict</span><span class="p">)</span>
<span class="n">new_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">old_list</span><span class="p">)</span>
</pre></div>
</div>
<ul ><li >Python dictionary : creation and update</li></ul><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># -- creation empty dict</span>
<span class="n">my_dict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">my_dict2</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

<span class="c1"># -- creation with values</span>
<span class="c1"># bad</span>
<span class="n">my_dict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">my_dict</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">my_dict</span><span class="p">[</span><span class="s1">&#39;bar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>
<span class="c1"># good</span>
<span class="n">my_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;foo&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}</span>

<span class="c1"># -- update dict</span>
<span class="c1"># bad</span>
<span class="n">my_dict</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">my_dict</span><span class="p">[</span><span class="s1">&#39;bar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">my_dict</span><span class="p">[</span><span class="s1">&#39;baz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
<span class="c1"># good</span>
<span class="n">my_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">foo</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">bar</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">baz</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">my_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">my_dict</span><span class="p">,</span> <span class="o">**</span><span class="n">my_dict2</span><span class="p">)</span>
</pre></div>
</div>
<ul ><li >Use meaningful variable/class/method names</li><li >Useless variable : Temporary variables can make the code clearer by giving
names to objects, but that doesn’t mean you should create temporary variables
all the time:</li></ul><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># pointless</span>
<span class="n">schema</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;schema&#39;</span><span class="p">]</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;schema&#39;</span><span class="p">:</span> <span class="n">schema</span><span class="p">}</span>
<span class="c1"># simpler</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;schema&#39;</span><span class="p">:</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;schema&#39;</span><span class="p">]}</span>
</pre></div>
</div>
<ul ><li >Multiple return points are OK, when they’re simpler</li></ul><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># a bit complex and with a redundant temp variable</span>
<span class="k">def</span> <span class="nf">axes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">([]):</span>
                <span class="n">axes</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
                <span class="n">axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">axes</span>

 <span class="c1"># clearer</span>
<span class="k">def</span> <span class="nf">axes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">([]):</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span> <span class="c1"># clone the axis</span>
        <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">axis</span><span class="p">]</span> <span class="c1"># single-element list</span>
</pre></div>
</div>
<ul ><li >Know your builtins : You should at least have a basic understanding of all
the Python builtins (<a href="http://docs.python.org/library/functions.html" class="reference external">http://docs.python.org/library/functions.html</a>)</li></ul><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="o">=</span> <span class="n">my_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="c1"># very very redundant</span>
<span class="n">value</span> <span class="o">=</span> <span class="n">my_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">)</span> <span class="c1"># good</span>
</pre></div>
</div>
<p >Also, <code >if 'key' in my_dict</code> and <code >if my_dict.get('key')</code> have very different
meaning, be sure that you’re using the right one.</p><ul ><li >Learn list comprehensions : Use list comprehension, dict comprehension, and
basic manipulation using <code >map</code>, <code >filter</code>, <code >sum</code>, … They make the code
easier to read.</li></ul><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># not very good</span>
<span class="n">cube</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">res</span><span class="p">:</span>
        <span class="n">cube</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]))</span>
<span class="c1"># better</span>
<span class="n">cube</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">res</span><span class="p">]</span>
</pre></div>
</div>
<ul ><li >Collections are booleans too : In python, many objects have «boolean-ish» value
when evaluated in a boolean context (such as an if). Among these are collections
(lists, dicts, sets, …) which are «falsy» when empty and «truthy» when containing
items:</li></ul><div class="highlight-python"><div class="highlight"><pre><span></span><span class="nb">bool</span><span class="p">([])</span> <span class="ow">is</span> <span class="kc">False</span>
<span class="nb">bool</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span> <span class="ow">is</span> <span class="kc">True</span>
<span class="nb">bool</span><span class="p">([</span><span class="kc">False</span><span class="p">])</span> <span class="ow">is</span> <span class="kc">True</span>
</pre></div>
</div>
<p >So, you can write <code >if some_collection:</code> instead of <code >if len(some_collection):</code>.</p><ul ><li >Iterate on iterables</li></ul><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># creates a temporary list and looks bar</span>
<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">my_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="s2">&quot;do something...&quot;</span>
<span class="c1"># better</span>
<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">my_dict</span><span class="p">:</span>
        <span class="s2">&quot;do something...&quot;</span>
<span class="c1"># accessing the key,value pair</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">my_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="s2">&quot;do something...&quot;</span>
</pre></div>
</div>
<ul ><li >Use dict.setdefault</li></ul><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># longer.. harder to read</span>
<span class="n">values</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">iterable</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">element</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="n">values</span><span class="p">[</span><span class="n">element</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">values</span><span class="p">[</span><span class="n">element</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">other_value</span><span class="p">)</span>

<span class="c1"># better.. use dict.setdefault method</span>
<span class="n">values</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">iterable</span><span class="p">:</span>
    <span class="n">values</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">other_value</span><span class="p">)</span>
</pre></div>
</div>
<ul ><li >As a good developper, document your code (docstring on methods, simple
comments for tricky part of code)</li><li >In additions to these guidelines, you may also find the following link
interesting: <a href="http://python.net/~goodger/projects/pycon/2007/idiomatic/handout.html" class="reference external">http://python.net/~goodger/projects/pycon/2007/idiomatic/handout.html</a>
(a little bit outdated, but quite relevant)</li></ul></section><section id="programming-in-odoo"><h3 >Programming in Odoo</h3><ul ><li >Avoid to create generators and decorators: only use the ones provided by
the Odoo API.</li><li >As in python, use <code >filtered</code>, <code >mapped</code>, <code >sorted</code>, … methods to
ease code reading and performance.</li></ul></section><section id="make-your-method-work-in-batch"><h4 >Make your method work in batch</h4><p >When adding a function, make sure it can process multiple records by iterating
on self to treat each record.</p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">my_method</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
        <span class="n">record</span><span class="o">.</span><span class="n">do_cool_stuff</span><span class="p">()</span>
</pre></div>
</div>
<p >For performance issue, when developping a „stat button“ (for instance), do not
perform a <code >search</code> or a <code >search_count</code> in a loop. It
is recommended to use <code >read_group</code> method, to compute all value in only one request.</p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">_compute_equipment_count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="sd">&quot;&quot;&quot; Count the number of equipement per category &quot;&quot;&quot;</span>
    <span class="n">equipment_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;hr.equipment&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">read_group</span><span class="p">([(</span><span class="s1">&#39;category_id&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ids</span><span class="p">)],</span> <span class="p">[</span><span class="s1">&#39;category_id&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;category_id&#39;</span><span class="p">])</span>
    <span class="n">mapped_data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;category_id&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">[</span><span class="s1">&#39;category_id_count&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">equipment_data</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">category</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
        <span class="n">category</span><span class="o">.</span><span class="n">equipment_count</span> <span class="o">=</span> <span class="n">mapped_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">category</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</section><section id="propagate-the-context"><h4 >Propagate the context</h4><p >The context is a <code >frozendict</code> that cannot be modified. To call a method with
a different context, the <code >with_context</code> method should be used :</p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">records</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">new_context</span><span class="p">)</span><span class="o">.</span><span class="n">do_stuff</span><span class="p">()</span> <span class="c1"># all the context is replaced</span>
<span class="n">records</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="o">**</span><span class="n">additionnal_context</span><span class="p">)</span><span class="o">.</span><span class="n">do_other_stuff</span><span class="p">()</span> <span class="c1"># additionnal_context values override native context ones</span>
</pre></div>
</div>
<div role="alert" class="alert-warning alert"><h3 class="alert-title">Предупреждение</h3><p >Passing parameter in context can have dangerous side-effects.</p><p >Since the values are propagated automatically, some unexpected behavior may appear.
Calling <code >create()</code> method of a model with <em >default_my_field</em> key in context
will set the default value of <em >my_field</em> for the concerned model.
But if during this creation, other objects (such as sale.order.line, on sale.order creation)
having a field name <em >my_field</em> are created, their default value will be set too.</p></div><p >If you need to create a key context influencing the behavior of some object,
choice a good name, and eventually prefix it by the name of the module to
isolate its impact. A good example are the keys of <code >mail</code> module :
<em >mail_create_nosubscribe</em>, <em >mail_notrack</em>, <em >mail_notify_user_signature</em>, …</p></section><section id="do-not-bypass-the-orm"><h4 >Do not bypass the ORM</h4><p >You should never use the database cursor directly when the ORM can do the same
thing! By doing so you are bypassing all the ORM features, possibly the
transactions, access rights and so on.</p><p >And chances are that you are also making the code harder to read and probably
less secure.</p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># very very wrong</span>
<span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">cr</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT id FROM auction_lots WHERE auction_id in (&#39;</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">ids</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;) AND state=</span><span class="si">%s</span><span class="s1"> AND obj_price &gt; 0&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;draft&#39;</span><span class="p">,))</span>
<span class="n">auction_lots_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">cr</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>

<span class="c1"># no injection, but still wrong</span>
<span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">cr</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT id FROM auction_lots WHERE auction_id in </span><span class="si">%s</span><span class="s1"> &#39;</span>\
           <span class="s1">&#39;AND state=</span><span class="si">%s</span><span class="s1"> AND obj_price &gt; 0&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">ids</span><span class="p">),</span> <span class="s1">&#39;draft&#39;</span><span class="p">,))</span>
<span class="n">auction_lots_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">cr</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>

<span class="c1"># better</span>
<span class="n">auction_lots_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;auction_id&#39;</span><span class="p">,</span><span class="s1">&#39;in&#39;</span><span class="p">,</span><span class="n">ids</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;state&#39;</span><span class="p">,</span><span class="s1">&#39;=&#39;</span><span class="p">,</span><span class="s1">&#39;draft&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;obj_price&#39;</span><span class="p">,</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)])</span>
</pre></div>
</div>
</section><section id="no-sql-injections-please"><h4 >No SQL injections, please !</h4><p >Care must be taken not to introduce SQL injections vulnerabilities when using
manual SQL queries. The vulnerability is present when user input is either
incorrectly filtered or badly quoted, allowing an attacker to introduce
undesirable clauses to a SQL query (such as circumventing filters or
executing UPDATE or DELETE commands).</p><p >The best way to be safe is to never, NEVER use Python string concatenation (+)
or string parameters interpolation (%) to pass variables to a SQL query string.</p><p >The second reason, which is almost as important, is that it is the job of the
database abstraction layer (psycopg2) to decide how to format query parameters,
not your job! For example psycopg2 knows that when you pass a list of values
it needs to format them as a comma-separated list, enclosed in parentheses !</p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># the following is very bad:</span>
<span class="c1">#   - it&#39;s a SQL injection vulnerability</span>
<span class="c1">#   - it&#39;s unreadable</span>
<span class="c1">#   - it&#39;s not your job to format the list of ids</span>
<span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">cr</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT distinct child_id FROM account_account_consol_rel &#39;</span> <span class="o">+</span>
           <span class="s1">&#39;WHERE parent_id IN (&#39;</span><span class="o">+</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">ids</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="p">)</span>

<span class="c1"># better</span>
<span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">cr</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT DISTINCT child_id &#39;</span>\
           <span class="s1">&#39;FROM account_account_consol_rel &#39;</span>\
           <span class="s1">&#39;WHERE parent_id IN </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span>
           <span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">ids</span><span class="p">),))</span>
</pre></div>
</div>
<p >This is very important, so please be careful also when refactoring, and most
importantly do not copy these patterns!</p><p >Here is a memorable example to help you remember what the issue is about (but
do not copy the code there). Before continuing, please be sure to read the
online documentation of pyscopg2 to learn of to use it properly:</p><ul ><li >The problem with query parameters (<a href="http://initd.org/psycopg/docs/usage.html#the-problem-with-the-query-parameters" class="reference external">http://initd.org/psycopg/docs/usage.html#the-problem-with-the-query-parameters</a>)</li><li >How to pass parameters with psycopg2 (<a href="http://initd.org/psycopg/docs/usage.html#passing-parameters-to-sql-queries" class="reference external">http://initd.org/psycopg/docs/usage.html#passing-parameters-to-sql-queries</a>)</li><li >Advanced parameter types (<a href="http://initd.org/psycopg/docs/usage.html#adaptation-of-python-values-to-sql-types" class="reference external">http://initd.org/psycopg/docs/usage.html#adaptation-of-python-values-to-sql-types</a>)</li></ul></section><section id="think-extendable"><h4 >Think extendable</h4><p >Functions and methods should not contain too much logic: having a lot of small
and simple methods is more advisable than having few large and complex methods.
A good rule of thumb is to split a method as soon as it has more than one
responsibility (see <a href="http://en.wikipedia.org/wiki/Single_responsibility_principle" class="reference external">http://en.wikipedia.org/wiki/Single_responsibility_principle</a>).</p><p >Hardcoding a business logic in a method should be avoided as it prevents to be
easily extended by a submodule.</p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># do not do this</span>
<span class="c1"># modifying the domain or criteria implies overriding whole method</span>
<span class="k">def</span> <span class="nf">action</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="o">...</span>  <span class="c1"># long method</span>
    <span class="n">partners</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">complex_domain</span><span class="p">)</span>
    <span class="n">emails</span> <span class="o">=</span> <span class="n">partners</span><span class="o">.</span><span class="n">filtered</span><span class="p">(</span><span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">arbitrary_criteria</span><span class="p">)</span><span class="o">.</span><span class="n">mapped</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">)</span>

<span class="c1"># better but do not do this either</span>
<span class="c1"># modifying the logic forces to duplicate some parts of the code</span>
<span class="k">def</span> <span class="nf">action</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="n">partners</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_partners</span><span class="p">()</span>
    <span class="n">emails</span> <span class="o">=</span> <span class="n">partners</span><span class="o">.</span><span class="n">_get_emails</span><span class="p">()</span>

<span class="c1"># better</span>
<span class="c1"># minimum override</span>
<span class="k">def</span> <span class="nf">action</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="n">partners</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_partner_domain</span><span class="p">())</span>
    <span class="n">emails</span> <span class="o">=</span> <span class="n">partners</span><span class="o">.</span><span class="n">filtered</span><span class="p">(</span><span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">_filter_partners</span><span class="p">())</span><span class="o">.</span><span class="n">mapped</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p >The above code is over extendable for the sake of example but the readability
must be taken into account and a tradeoff must be made.</p><p >Also, name your functions accordingly: small and properly named functions are
the starting point of readable/maintainable code and tighter documentation.</p><p >This recommendation is also relevant for classes, files, modules and packages.
(See also <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity" class="reference external">http://en.wikipedia.org/wiki/Cyclomatic_complexity</a>)</p></section><section id="never-commit-the-transaction"><h4 >Never commit the transaction</h4><p >The Odoo framework is in charge of providing the transactional context for
all RPC calls. The principle is that a new database cursor is opened at the
beginning of each RPC call, and committed when the call has returned, just
before transmitting the answer to the RPC client, approximately like this:</p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db_name</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="n">db</span><span class="p">,</span> <span class="n">pool</span> <span class="o">=</span> <span class="n">pooler</span><span class="o">.</span><span class="n">get_db_and_pool</span><span class="p">(</span><span class="n">db_name</span><span class="p">)</span>
    <span class="c1"># create transaction cursor</span>
    <span class="n">cr</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">execute_cr</span><span class="p">(</span><span class="n">cr</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="n">cr</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span> <span class="c1"># all good, we commit</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">cr</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span> <span class="c1"># error, rollback everything atomically</span>
        <span class="k">raise</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">cr</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> <span class="c1"># always close cursor opened manually</span>
    <span class="k">return</span> <span class="n">res</span>
</pre></div>
</div>
<p >If any error occurs during the execution of the RPC call, the transaction is
rolled back atomically, preserving the state of the system.</p><p >Similarly, the system also provides a dedicated transaction during the execution
of tests suites, so it can be rolled back or not depending on the server
startup options.</p><p >The consequence is that if you manually call <code >cr.commit()</code> anywhere there is
a very high chance that you will break the system in various ways, because you
will cause partial commits, and thus partial and unclean rollbacks, causing
among others:</p><ol ><li >inconsistent business data, usually data loss</li><li >workflow desynchronization, documents stuck permanently</li><li >tests that can’t be rolled back cleanly, and will start polluting the
database, and triggering error (this is true even if no error occurs
during the transaction)</li></ol><dl ><dt >Here is the very simple rule:</dt><dd ><p >You should <strong >NEVER</strong> call <code >cr.commit()</code> yourself, <strong >UNLESS</strong> you have
created your own database cursor explicitly! And the situations where you
need to do that are exceptional!</p><p >And by the way if you did create your own cursor, then you need to handle
error cases and proper rollback, as well as properly close the cursor when
you’re done with it.</p></dd></dl><p >And contrary to popular belief, you do not even need to call <code >cr.commit()</code>
in the following situations:
- in the <code >_auto_init()</code> method of an <em >models.Model</em> object: this is taken
care of by the addons initialization method, or by the ORM transaction when
creating custom models
- in reports: the <code >commit()</code> is handled by the framework too, so you can
update the database even from within a report
- within <em >models.Transient</em> methods: these methods are called exactly like
regular <em >models.Model</em> ones, within a transaction and with the corresponding
<code >cr.commit()/rollback()</code> at the end
- etc. (see general rule above if you have in doubt!)</p><p >All <code >cr.commit()</code> calls outside of the server framework from now on must
have an <strong >explicit comment</strong> explaining why they are absolutely necessary, why
they are indeed correct, and why they do not break the transactions. Otherwise
they can and will be removed !</p></section><section id="use-translation-method-correctly"><h4 >Use translation method correctly</h4><p >Odoo uses a GetText-like method named «underscore» <code >_( )</code> to indicate that
a static string used in the code needs to be translated at runtime using the
language of the context. This pseudo-method is accessed within your code by
importing as follows:</p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">odoo</span> <span class="kn">import</span> <span class="n">_</span>
</pre></div>
</div>
<p >A few very important rules must be followed when using it, in order for it to
work and to avoid filling the translations with useless junk.</p><p >Basically, this method should only be used for static strings written manually
in the code, it will not work to translate field values, such as Product names,
etc. This must be done instead using the translate flag on the corresponding
field.</p><p >The rule is very simple: calls to the underscore method should always be in
the form <code >_('literal string')</code> and nothing else:</p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># good: plain strings</span>
<span class="n">error</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;This record is locked!&#39;</span><span class="p">)</span>

<span class="c1"># good: strings with formatting patterns included</span>
<span class="n">error</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Record </span><span class="si">%s</span><span class="s1"> cannot be modified!&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="n">record</span>

<span class="c1"># ok too: multi-line literal strings</span>
<span class="n">error</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;This is a bad multiline example</span>
<span class="s2">             about record </span><span class="si">%s</span><span class="s2">!&quot;&quot;&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="n">record</span>
<span class="n">error</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Record </span><span class="si">%s</span><span class="s1"> cannot be modified&#39;</span> \
          <span class="s1">&#39;after being validated!&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="n">record</span>

<span class="c1"># bad: tries to translate after string formatting</span>
<span class="c1">#      (pay attention to brackets!)</span>
<span class="c1"># This does NOT work and messes up the translations!</span>
<span class="n">error</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Record </span><span class="si">%s</span><span class="s1"> cannot be modified!&#39;</span> <span class="o">%</span> <span class="n">record</span><span class="p">)</span>

<span class="c1"># bad: dynamic string, string concatenation, etc are forbidden!</span>
<span class="c1"># This does NOT work and messes up the translations!</span>
<span class="n">error</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="n">que_rec</span><span class="p">[</span><span class="s1">&#39;question&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&#39; </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># bad: field values are automatically translated by the framework</span>
<span class="c1"># This is useless and will not work the way you think:</span>
<span class="n">error</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Product </span><span class="si">%s</span><span class="s2"> is out of stock!&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="n">_</span><span class="p">(</span><span class="n">product</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="c1"># and the following will of course not work as already explained:</span>
<span class="n">error</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Product </span><span class="si">%s</span><span class="s2"> is out of stock!&quot;</span> <span class="o">%</span> <span class="n">product</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

<span class="c1"># bad: field values are automatically translated by the framework</span>
<span class="c1"># This is useless and will not work the way you think:</span>
<span class="n">error</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Product </span><span class="si">%s</span><span class="s2"> is not available!&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="n">_</span><span class="p">(</span><span class="n">product</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="c1"># and the following will of course not work as already explained:</span>
<span class="n">error</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Product </span><span class="si">%s</span><span class="s2"> is not available!&quot;</span> <span class="o">%</span> <span class="n">product</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

<span class="c1"># Instead you can do the following and everything will be translated,</span>
<span class="c1"># including the product name if its field definition has the</span>
<span class="c1"># translate flag properly set:</span>
<span class="n">error</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Product </span><span class="si">%s</span><span class="s2"> is not available!&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="n">product</span><span class="o">.</span><span class="n">name</span>
</pre></div>
</div>
<p >Also, keep in mind that translators will have to work with the literal values
that are passed to the underscore function, so please try to make them easy to
understand and keep spurious characters and formatting to a minimum. Translators
must be aware that formatting patterns such as %s or %d, newlines, etc. need
to be preserved, but it’s important to use these in a sensible and obvious manner:</p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Bad: makes the translations hard to work with</span>
<span class="n">error</span> <span class="o">=</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="n">question</span> <span class="o">+</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;&#39; </span><span class="se">\n</span><span class="s2">Please enter an integer value &quot;</span><span class="p">)</span>

<span class="c1"># Better (pay attention to position of the brackets too!)</span>
<span class="n">error</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Answer to question </span><span class="si">%s</span><span class="s2"> is not valid.</span><span class="se">\n</span><span class="s2">&quot;</span> \
          <span class="s2">&quot;Please enter an integer value.&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="n">question</span>
</pre></div>
</div>
<p >In general in Odoo, when manipulating strings, prefer <code >%</code> over <code >.format()</code>
(when only one variable to replace in a string), and prefer <code >%(varname)</code> instead
of position (when multiple variables have to be replaced). This makes the
translation easier for the community translators.</p></section><section id="symbols-and-conventions"><h3 >Symbols and Conventions</h3><ul ><li ><dl ><dt >Model name (using the dot notation, prefix by the module name) :</dt><dd ><ul ><li >When defining an Odoo Model : use singular form of the name (<em >res.partner</em>
and <em >sale.order</em> instead of <em >res.partnerS</em> and <em >saleS.orderS</em>)</li><li >When defining an Odoo Transient (wizard) : use <code >&lt;related_base_model&gt;.&lt;action&gt;</code>
where <em >related_base_model</em> is the base model (defined in <em >models/</em>) related
to the transient, and <em >action</em> is the short name of what the transient do. Avoid the <em >wizard</em> word.
For instance : <code >account.invoice.make</code>, <code >project.task.delegate.batch</code>, …</li><li >When defining <em >report</em> model (SQL views e.i.) : use
<code >&lt;related_base_model&gt;.report.&lt;action&gt;</code>, based on the Transient convention.</li></ul></dd></dl></li><li >Odoo Python Class : use camelcase (Object-oriented style).</li></ul><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AccountInvoice</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<ul ><li ><dl ><dt >Variable name :</dt><dd ><ul ><li >use camelcase for model variable</li><li >use underscore lowercase notation for common variable.</li><li >suffix your variable name with <em >_id</em> or <em >_ids</em> if it contains a record id or list of id. Don’t use <code >partner_id</code> to contain a record of res.partner</li></ul></dd></dl></li></ul><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">Partner</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">]</span>
<span class="n">partners</span> <span class="o">=</span> <span class="n">Partner</span><span class="o">.</span><span class="n">browse</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span>
<span class="n">partner_id</span> <span class="o">=</span> <span class="n">partners</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span>
</pre></div>
</div>
<ul ><li ><code >One2Many</code> and <code >Many2Many</code> fields should always have <em >_ids</em> as suffix (example: sale_order_line_ids)</li><li ><code >Many2One</code> fields should have <em >_id</em> as suffix (example : partner_id, user_id, …)</li><li ><dl ><dt >Method conventions</dt><dd ><ul ><li >Compute Field : the compute method pattern is <em >_compute_&lt;field_name&gt;</em></li><li >Search method : the search method pattern is <em >_search_&lt;field_name&gt;</em></li><li >Default method : the default method pattern is <em >_default_&lt;field_name&gt;</em></li><li >Selection method: the selection method pattern is <em >_selection_&lt;field_name&gt;</em></li><li >Onchange method : the onchange method pattern is <em >_onchange_&lt;field_name&gt;</em></li><li >Constraint method : the constraint method pattern is <em >_check_&lt;constraint_name&gt;</em></li><li >Action method : an object action method is prefix with <em >action_</em>.
Since it uses only one record, add <code >self.ensure_one()</code>
at the beginning of the method.</li></ul></dd></dl></li><li ><dl ><dt >In a Model attribute order should be</dt><dd ><ol ><li >Private attributes (<code >_name</code>, <code >_description</code>, <code >_inherit</code>, …)</li><li >Default method and <code >_default_get</code></li><li >Field declarations</li><li >Compute, inverse and search methods in the same order as field declaration</li><li >Selection method (methods used to return computed values for selection fields)</li><li >Constrains methods (<code >@api.constrains</code>) and onchange methods (<code >@api.onchange</code>)</li><li >CRUD methods (ORM overrides)</li><li >Action methods</li><li >And finally, other business methods.</li></ol></dd></dl></li></ul><div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Event</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="c1"># Private attributes</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;event.event&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Event&#39;</span>

    <span class="c1"># Default methods</span>
    <span class="k">def</span> <span class="nf">_default_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="c1"># Fields declaration</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">_default_name</span><span class="p">)</span>
    <span class="n">seats_reserved</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">oldname</span><span class="o">=</span><span class="s1">&#39;register_current&#39;</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s1">&#39;Reserved Seats&#39;</span><span class="p">,</span>
        <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_seats&#39;</span><span class="p">)</span>
    <span class="n">seats_available</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">oldname</span><span class="o">=</span><span class="s1">&#39;register_avail&#39;</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s1">&#39;Available Seats&#39;</span><span class="p">,</span>
        <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_seats&#39;</span><span class="p">)</span>
    <span class="n">price</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s1">&#39;Price&#39;</span><span class="p">)</span>
    <span class="n">event_type</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Selection</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s2">&quot;Type&quot;</span><span class="p">,</span> <span class="n">selection</span><span class="o">=</span><span class="s1">&#39;_selection_type&#39;</span><span class="p">)</span>

    <span class="c1"># compute and search fields, in the same order of fields declaration</span>
    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;seats_max&#39;</span><span class="p">,</span> <span class="s1">&#39;registration_ids.state&#39;</span><span class="p">,</span> <span class="s1">&#39;registration_ids.nb_register&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_seats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">model</span>
    <span class="k">def</span> <span class="nf">_selection_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="c1"># Constraints and onchanges</span>
    <span class="nd">@api</span><span class="o">.</span><span class="n">constrains</span><span class="p">(</span><span class="s1">&#39;seats_max&#39;</span><span class="p">,</span> <span class="s1">&#39;seats_available&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_check_seats_limit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">onchange</span><span class="p">(</span><span class="s1">&#39;date_begin&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_onchange_date_begin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="c1"># CRUD methods (and name_get, name_search, ...) overrides</span>
    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="c1"># Action methods</span>
    <span class="k">def</span> <span class="nf">action_validate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ensure_one</span><span class="p">()</span>
        <span class="o">...</span>

    <span class="c1"># Business methods</span>
    <span class="k">def</span> <span class="nf">mail_user_confirm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="o">...</span>
</pre></div>
</div>
</section><section id="javascript-and-css"><i id="reference-guidelines-js"></i><h2 >Javascript and CSS</h2></section><section id="static-files-organization"><h3 >Static files organization</h3><p >Odoo addons have some conventions on how to structure various files. We explain
here in more details how web assets are supposed to be organized.</p><p >The first thing to know is that the Odoo server will serve (statically) all files
located in a <em >static/</em> folder, but prefixed with the addon name. So, for example,
if a file is located in <em >addons/web/static/src/js/some_file.js</em>, then it will be
statically available at the url <em >your-odoo-server.com/web/static/src/js/some_file.js</em></p><p >The convention is to organize the code according to the following structure:</p><ul ><li ><p ><em >static</em>: all static files in general</p><ul ><li ><em >static/lib</em>: this is the place where js libs should be located, in a sub folder.
So, for example, all files from the <em >jquery</em> library are in <em >addons/web/static/lib/jquery</em></li><li ><p ><em >static/src</em>: the generic static source code folder</p><ul ><li ><em >static/src/css</em>: all css files</li><li ><em >static/src/fonts</em></li><li ><em >static/src/img</em></li><li ><p ><em >static/src/js</em></p><ul ><li ><em >static/src/js/tours</em>: end user tour files (tutorials, not tests)</li></ul></li><li ><em >static/src/scss</em>: scss files</li><li ><em >static/src/xml</em>: all qweb templates that will be rendered in JS</li></ul></li><li ><p ><em >static/tests</em>: this is where we put all test related files.</p><ul ><li ><em >static/tests/tours</em>: this is where we put all tour test files (not tutorials).</li></ul></li></ul></li></ul></section><section id="javascript-coding-guidelines"><h3 >Javascript coding guidelines</h3><ul ><li ><code >use strict;</code> is recommended for all javascript files</li><li >Use a linter (jshint, …)</li><li >Never add minified Javascript Libraries</li><li >Use camelcase for class declaration</li></ul><p >More precise JS guidelines are detailed in the <a href="https://github.com/odoo/odoo/wiki/Javascript-coding-guidelines" class="reference external">github wiki</a>.
You may also have a look at existing API in Javascript by looking Javascript
References.</p></section><section id="css-coding-guidelines"><h3 >CSS coding guidelines</h3><ul ><li >Prefix all your classes with <em >o_&lt;module_name&gt;</em> where <em >module_name</em> is the
technical name of the module („sale“, „im_chat“, …) or the main route
reserved by the module (for website module mainly, i.e. : „o_forum“ for
<em >website_forum</em> module). The only exception for this rule is the
webclient: it simply uses <em >o_</em> prefix.</li><li >Avoid using <em >id</em> tag</li><li >Use Bootstrap native classes</li><li >Use underscore lowercase notation to name class</li></ul></section><section id="git"><i id="reference-guidelines-git"></i><h2 >Git</h2></section><section id="configure-your-git"><h3 >Configure your git</h3><p >Based on ancestral experience and oral tradition, the following things go a long
way towards making your commits more helpful:</p><ul ><li ><p >Be sure to define both the user.email and user.name in your local git config</p><div class="highlight-text"><div class="highlight"><pre><span></span>git config --global &lt;var&gt; &lt;value&gt;
</pre></div>
</div>
</li><li >Be sure to add your full name to your Github profile here. Please feel fancy
and add your team, avatar, your favorite quote, and whatnot ;-)</li></ul></section><section id="commit-message-structure"><h3 >Commit message structure</h3><p >Commit message has four parts: tag, module, short description and full
description. Try to follow the preferred structure for your commit messages</p><div class="highlight-text"><div class="highlight"><pre><span></span>[TAG] module: describe your change in a short sentence (ideally &lt; 50 chars)

Long version of the change description, including the rationale for the change,
or a summary of the feature being introduced.

Please spend a lot more time describing WHY the change is being done rather
than WHAT is being changed. This is usually easy to grasp by actually reading
the diff. WHAT should be explained only if there are technical choices
or decision involved. In that case explain WHY this decision was taken.

End the message with references, such as task or bug numbers, PR numbers, and
OPW tickets, following the suggested format:
task-123 (related to task)
Fixes #123  (close related issue on Github)
Closes #123  (close related PR on Github)
opw-123 (related to ticket)
</pre></div>
</div>
</section><section id="tag-and-module-name"><h3 >Tag and module name</h3><p >Tags are used to prefix your commit. They should be one of the following</p><ul ><li ><strong >[FIX]</strong> for bug fixes: mostly used in stable version but also valid if you
are fixing a recent bug in development version;</li><li ><strong >[REF]</strong> for refactoring: when a feature is heavily rewritten;</li><li ><strong >[ADD]</strong> for adding new modules;</li><li ><strong >[REM]</strong> for removing resources: removing dead code, removing views,
removing modules, …;</li><li ><strong >[REV]</strong> for reverting commits: if a commit causes issues or is not wanted
reverting it is done using this tag;</li><li ><strong >[MOV]</strong> for moving files: use git move and do not change content of moved file
otherwise Git may loose track and history of the file; also used when moving
code from one file to another;</li><li ><strong >[REL]</strong> for release commits: new major or minor stable versions;</li><li ><strong >[IMP]</strong> for improvements: most of the changes done in development version
are incremental improvements not related to another tag;</li><li ><strong >[MERGE]</strong> for merge commits: used in forward port of bug fixes but also as
main commit for feature involving several separated commits;</li><li ><strong >[CLA]</strong> for signing the Odoo Individual Contributor License;</li><li ><strong >[I18N]</strong> for changes in translation files;</li></ul><p >After tag comes the modified module name. Use the technical name as functional
name may change with time. If several modules are modified, list them or use
various to tell it is cross-modules. Unless really required or easier avoid
modifying code across several modules in the same commit. Understanding module
history may become difficult.</p></section><section id="commit-message-header"><h3 >Commit message header</h3><p >After tag and module name comes a meaningful commit message header. It should be
self explanatory and include the reason behind the change. Do not use single words
like «bugfix» or «improvements». Try to limit the header length to about 50 characters
for readability.</p><p >Commit message header should make a valid sentence once concatenated with
<code >if applied, this commit will &lt;header&gt;</code>. For example <code >[IMP] base: prevent to
archive users linked to active partners</code> is correct as it makes a valid sentence
<code >if applied, this commit will prevent users to archive...</code>.</p></section><section id="commit-message-full-description"><h3 >Commit message full description</h3><p >In the message description specify the part of the code impacted by your changes
(module name, lib, transversal object, …) and a description of the changes.</p><p >First explain WHY you are modifying code. What is important if someone goes back
to your commit in about 4 decades (or 3 days) is why you did it. It is the
purpose of the change.</p><p >What you did can be found in the commit itself. If there was some technical choices
involved it is a good idea to explain it also in the commit message after the why.
For Odoo R&amp;D developers «PO team asked me to do it» is not a valid why, by the way.</p><p >Please avoid commits which simultaneously impact multiple modules. Try to split
into different commits where impacted modules are different. It will be helpful
if we need to revert changes in a given module separately.</p><p >Don’t hesitate to be a bit verbose. Most people will only see your commit message
and judge everything you did in your life just based on those few sentences.
No pressure at all.</p><p ><strong >You spend several hours, days or weeks working on meaningful features. Take
some time to calm down and write clear and understandable commit messages.</strong></p><p >If you are an Odoo R&amp;D developer the WHY should be the purpose of the task you
are working on. Full specifications make the core of the commit message.
<strong >If you are working on a task that lacks purpose and specifications please
consider making them clear before continuing.</strong></p><p >Finally here are some examples of correct commit messages :</p><div class="highlight-text"><div class="highlight"><pre><span></span>[REF] models: use `parent_path` to implement parent_store

 This replaces the former modified preorder tree traversal (MPTT) with the
 fields `parent_left`/`parent_right`[...]

[FIX] account: remove frenglish

 [...]

 Closes #22793
 Fixes #22769

[FIX] website: remove unused alert div, fixes look of input-group-btn

 Bootstrap&#39;s CSS depends on the input-group-btn
 element being the first/last child of its parent.
 This was not the case because of the invisible
 and useless alert.
</pre></div>
</div>
<div role="alert" class="alert-info alert"><h3 class="alert-title">Примечание</h3><p >Use the long description to explain the <em >why</em> not the
<em >what</em>, the <em >what</em> can be seen in the diff</p></div></section>

          </article>
        </div>
        
        <div id="mask"></div>
      </main>
  </div>

  <div class="floating_action_container">
    <a id="floating_action" class="ripple" href="#">
      <i class="mdi-action-explore"></i>
    </a>
    <div id="floating_action_menu">
      <span class="bubble"></span>
      <ul class="list-group content">
        <li class="list-group-item ripple"><a>Cras justo odio</a></li>
        <li class="list-group-item ripple"><a>Dapibus ac facilisis in</a></li>
        <li class="list-group-item ripple"><a>Morbi leo risus</a></li>
        <li class="list-group-item ripple"><a>Porta ac consectetur ac</a></li>
        <li class="list-group-item ripple"><a>Vestibulum at eros</a></li>
      </ul>
    </div>
  </div>
  <footer>
    <div id="footer" class="container">
      <span class="o_logo o_logo_inverse center-block o_footer_logo"></span>
      <div class="row">
        <div class="col-sm-7 col-md-7 col-lg-6">
          <div class="row">
            <div class="col-xs-6 col-sm-4">
              <span class="menu_title">Community</span>
              <ul>
                <li><a href="https://github.com/odoo/odoo">Github</a></li>
                <li><a href="http://www.odoo.com/page/download">Download</a></li>
                <li class="divider"></li>
                <li><a href="http://runbot.odoo.com/runbot/repo/git-github-com-odoo-enterprise-7">Runbot</a></li>
                <li><a href="https://github.com/odoo/odoo/wiki/Translations">Translations</a></li>
                <li class="divider"></li>
                <li><a href="http://www.odoo.com/page/odoo-community">Mailing Lists</a></li>
                <li><a href="http://www.odoo.com/forum/help-1">Forum</a></li>
              </ul>
            </div>
            <div class="col-xs-6 col-sm-4">
              <span class="menu_title">Services</span>
              <ul>
                <li><a href="https://www.odoo.sh">Odoo Cloud Platform</a></li>
                <li class="divider"></li>
                <li><a href="http://www.odoo.com/help">Support</a></li>
                <li><a href="https://upgrade.odoo.com">Upgrade</a></li>
                <li class="divider"></li>
                <li><a href="http://www.odoo.com/partners">Find a partner</a></li>
                <li><a href="http://www.odoo.com/page/become-a-partner">Become a partner</a></li>
                <li class="divider"></li>
                <li><a href="http://training.odoo.com/courses/odoo-functional">Training Center</a></li>
                <li><a href="http://www.odoo.com/page/education-program">Education</a></li>
                <li class="divider"></li>
                <li><a href="http://www.odoo.com/page/security">Security</a></li>
              </ul>
            </div>
            <div class="col-xs-12 col-sm-4 mb64">
              <span class="menu_title">About us</span>
              <ul>
                <li><a href="http://www.odoo.com/page/about-us">Our company</a></li>
                <li><a href="http://www.odoo.com/page/contactus">Contact</a></li>
                <li class="divider" />
                <li><a href="http://www.odoo.com/event">Events</a></li>
                <li><a href="http://www.odoo.com/blog">Blog</a></li>
                <li><a href="http://www.odoo.com/blog/6">Customers</a></li>
                <li class="divider" />
                <li><a href="http://www.odoo.com/jobs">Jobs</a></li>
                <li class="divider" />
                <li><a href="http://www.odoo.com/page/legal">Legal</a> | <a href="http://www.odoo.com/privacy">Privacy</a></li>
              </ul>
            </div>
          </div>
        </div>
        <div class="col-sm-5 col-md-4 col-md-offset-1 col-lg-5 col-lg-offset-1">
          <p>
            <small>
              Odoo is a suite of open source business apps that cover all your company needs: CRM, eCommerce, accounting, inventory, point of sale, project management, etc.
              <br/><br/>
              Odoo's unique value proposition is to be at the same time very easy to use and fully integrated.
            </small>
          </p>
        </div>
      </div>
    </div>
    <div class="o_footer_bottom">
      <div class="container">
        <a class="small" href="http://www.odoo.com/page/website-builder">Website made with <span class="o_logo o_logo_inverse o_logo_15"></span></a>
        <div class="social-links pull-right">
          <a href="http://www.odoo.com/web/about/facebook"><i class="fa fa-facebook"></i></a>
          <a href="http://www.odoo.com/web/about/twitter"><i class="fa fa-twitter"></i></a>
          <a href="http://www.odoo.com/web/about/linkedin"><i class="fa fa-linkedin"></i></a>
          <a href="mailto:info@odoo.com"><i class="fa fa-envelope"></i></a>
        </div>
      </div>
    </div>
  </footer>
  </body>
</html>