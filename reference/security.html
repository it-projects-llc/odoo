<!doctype html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="ru">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css?family=Work+Sans:500,600" rel="stylesheet">
  
    <title>Безопасность в Odoo &#8212; Документация odoo 13.0</title>
    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/patchqueue.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script type="text/javascript" src="../_static/jquery.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap.js"></script>
    <script type="text/javascript" src="../_static/doc.js"></script>
    <script type="text/javascript" src="../_static/jquery.noconflict.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <script type="text/javascript" src="../_static/patchqueue.js"></script><link rel="canonical" href="" />
  
    <link rel="index" title="Алфавитный указатель" href="../genindex.html" />
    <link rel="search" title="Поиск" href="../search.html" />
    <link rel="next" title="Тестирование Odoo" href="testing.html" />
    <link rel="prev" title="Интерфейс командной строки: odoo-bin" href="cmdline.html" /> 
  </head><body><header class="o_main_header o_has_sub_nav o_inverted ">
<!-- 
    <div class="o_main_header_main">
      <a class="pull-left o_logo" href="/"></a>
      <a href="#" class="o_mobile_menu_toggle visible-xs-block pull-right">
        <span class="sr-only">Toggle navigation</span>
        <span class="mdi-navigation-menu"></span>
      </a>
      <div class="o_header_buttons">
        <a href="http://www.odoo.com/trial" class="btn btn-primary">Start Now</a>
      </div>
      <ul class="o_primary_nav">
        <li class="dropdown">
          <a href="#" class="dropdown-toggle">Apps</a>
          <div class="dropdown-menu o_secondary_nav">
            <div class="container">
              <div class="row">
                <div class="col-sm-3 o_website_apps">
                  <div class="o_nav_app_family">
                    <span></span> Websites
                    <div>Build great user experience</div>
                  </div>
                  <ul>
                    <li><a href="https://www.odoo.com/page/website-builder">Website Builder</a></li>
                    <li><a href="https://www.odoo.com/page/e-commerce">eCommerce</a></li>
                    <li><a href="https://www.odoo.com/page/blog-engine">Blogs</a></li>
                    <li><a href="https://www.odoo.com/page/community-builder">Forums</a></li>
                    <li><a href="https://www.odoo.com/page/slides">Slides</a></li>
                    <li><a href="https://adspike.odoo.com">SEA</a></li>
                  </ul>
                </div>
                <div class="col-sm-3 o_sale_apps">
                  <div class="o_nav_app_family">
                    <span></span> Sales
                    <div>Boost your success rate</div>
                  </div>
                  <ul>
                    <li><a href="https://www.odoo.com/page/sales">Sales</a></li>
                    <li><a href="https://www.odoo.com/page/crm">CRM</a></li>
                    <li><a href="https://www.odoo.com/page/billing">Invoicing</a></li>
                    <li class="dropdown">
                      <a href="#0" class="dropdown-toggle">Point of Sale</a>
                      <ul>
                        <li><a href="https://www.odoo.com/page/point-of-sale">Shops</a></li>
                        <li><a href="https://www.odoo.com/page/pos-restaurant">Restaurants</a></li>
                      </ul>
                    </li>
                    <li><a href="https://www.odoo.com/page/subscriptions">Subscriptions</a></li>
                    <li><a href="https://www.odoo.com/page/sign">Sign</a></li>
                  </ul>
                </div>
                <div class="col-sm-3 o_operation_apps">
                  <div class="o_nav_app_family">
                    <span></span> Operations
                    <div>It's all about efficiency</div>
                  </div>
                  <ul>
                    <li><a href="https://www.odoo.com/page/accounting">Accounting</a></li>
                    <li><a href="https://www.odoo.com/page/project-management">Project</a></li>
                    <li class="dropdown">
                      <a href="#0" class="dropdown-toggle">Human Resources</a>
                      <ul>
                        <li><a href="https://www.odoo.com/page/recruitment">Recruitment</a></li>
                        <li><a href="https://www.odoo.com/page/employees">Employees</a></li>
                        <li><a href="https://www.odoo.com/page/expenses">Expenses</a></li>
                        <li><a href="https://www.odoo.com/page/appraisal">Appraisal</a></li>
                        <li><a href="https://www.odoo.com/page/fleet">Fleet</a></li>
                        <li><a href="https://www.odoo.com/page/leaves">Leaves</a></li>
                      </ul>
                    </li>
                    <li><a href="https://www.odoo.com/page/warehouse">Inventory</a></li>
                    <li><a href="https://www.odoo.com/page/purchase">Purchase</a></li>
                    <li class="dropdown">
                      <a href="#0" class="dropdown-toggle">Manufacturing</a>
                      <ul>
                        <li><a href="https://www.odoo.com/page/manufacturing">MRP</a></li>
                        <li><a href="https://www.odoo.com/page/plm">PLM</a></li>
                        <li><a href="https://www.odoo.com/page/maintenance">Maintenance</a></li>
                        <li><a href="https://www.odoo.com/page/quality">Quality</a></li>
                      </ul>
                    </li>
                  </ul>
                </div>
                <div class="col-sm-3 o_productivity_apps">
                  <div class="o_nav_app_family">
                    <span></span> Productivity Tools
                    <div>Great Tools = Happy People</div>
                  </div>
                  <ul>
                    <li class="dropdown">
                      <a href="#0" class="dropdown-toggle">Communication</a>
                      <ul>
                        <li><a href="https://www.odoo.com/page/discuss">Discuss</a></li>
                        <li><a href="https://www.odoo.com/page/discuss-groups">Mailing Lists</a></li>
                        <li><a href="https://www.odoo.com/page/notes">Notes</a></li>
                        <li><a href="#">Help desk</a></li>
                        <li><a href="#">Appointment</a></li>
                      </ul>
                    </li>
                    <li><a href="https://www.odoo.com/page/timesheet">Timesheet</a></li>
                    <li><a href="https://www.odoo.com/page/email-marketing">Email Marketing</a></li>
                    <li><a href="https://www.odoo.com/page/events">Events</a></li>
                    <li><a href="https://www.odoo.com/page/survey">Survey</a></li>
                    <li><a href="https://www.odoo.com/page/live-chat">Live Chat</a></li>
                  </ul>
                </div>
              </div>
            </div>
            <a href="http://www.odoo.com/apps/modules" class="o_store_link"><i class="fa fa-cube fa-fw"></i> Third party apps</a>
          </div>
        </li>
        <li><a href="https://www.odoo.com/page/tour">Tour</a></li>
        <li><a href="https://www.odoo.com/pricing">Pricing</a></li>
        <li><a href="https://www.odoo.com/page/docs">Docs</a></li>
      </ul>
    </div>
-->
    <nav class="navbar o_sub_nav">
      <div class="container">
        <div class="navbar-header visible-xs">
            <button type="button" class="navbar-toggle collapsed text-left btn-block" data-toggle="collapse" data-target="#o_sub-menu" aria-expanded="false">
              Navigate
              <span class="mdi-hardware-keyboard-arrow-down pull-right"></span>
            </button>
        </div>

        <div class="collapse navbar-collapse" id="o_sub-menu">
          <ol class="o_breadcrumb breadcrumb nav navbar-left">
              
              





    
        
            <li><a href="../index.html">Developer Doc</a></li>
        
    
    <li class="active"><a href="#">Безопасность в Odoo</a></li>

              
          </ol>

          <div class="call-to-action navbar-right hidden-xs">
            <a href="http://www.odoo.com/trial" class="btn btn-primary">Start Now</a>
          </div>

          <ul class="navbar-nav navbar-right nav o_sub_nav_actions">
            
              <li class="divider"></li>
            

            
            


            
          </ul>

          <ul class="nav navbar-nav navbar-right">
            

            
            
<!--
<li><a href="https://www.odoo.com/documentation/user/13.0/index.html">User</a></li>
<li><a href="https://www.odoo.com/documentation/13.0/index.html">Developer</a></li>
<li><a href="https://www.odoo.com/documentation/13.0/setup/install.html">Installation</a></li>
<li><a href="https://odoo.com/slides">eLearning</a></li>
<li><a href="https://www.odoo.com/page/odoo-white-paper">White Papers</a></li>
<li><a href="https://www.odoo.com/page/legal">Legal</a></li>
-->
            

            
          </ul>
        </div>
      </div>
    </nav>
  </header><div id="wrap" class="">
    
    
    
    <figure class="card top has_banner">
      <span class="card-img" style="background-image: url('../_static/banners/security.jpg');"></span>
      <div class="container text-center">
        <h1> Безопасность в Odoo </h1>
      </div>
    </figure>
    
    
    
      <main class="container ">
        
        <div class="o_content row">
          
          <aside>
            <div class="navbar-aside text-center">
              <ul class="list-group nav text-left"><li class="list-group-item"><a href="#access-control" class="internal ripple reference">Контроль доступа</a></li><li class="list-group-item"><a href="#record-rules" class="internal ripple reference">Правила записи</a></li><li class="list-group-item"><a href="#field-access" class="internal ripple reference">Доступ к полю</a></li><li class="list-group-item"><a href="#security-pitfalls" class="internal ripple reference">Security Pitfalls</a><ul ><li class="list-group-item"><a href="#unsafe-public-methods" class="internal ripple reference">Unsafe Public Methods</a></li><li class="list-group-item"><a href="#bypassing-the-orm" class="internal ripple reference">Bypassing the ORM</a><ul ><li class="list-group-item"><a href="#sql-injections" class="internal ripple reference">SQL injections</a></li></ul></li><li class="list-group-item"><a href="#unescaped-field-content" class="internal ripple reference">Unescaped field content</a></li><li class="list-group-item"><a href="#evaluating-content" class="internal ripple reference">Evaluating content</a></li><li class="list-group-item"><a href="#accessing-object-attributes" class="internal ripple reference">Accessing object attributes</a></li></ul></li></ul>
              
              <p class="gith-container"><a href="https://github.com/odoo/odoo/edit/13.0/doc/reference/security.rst" class="gith-link">
                  Edit on GitHub
              </a></p>
              
            </div>
          </aside>
          
          <article class="doc-body ">
            
            
  <section id="security-in-odoo"><i id="reference-security"></i><p >Помимо ручного управления доступом с помощью пользовательского кода, Odoo предоставляет два основных механизма, управляемых данными, для управления или ограничения доступа к данным.</p><p >Оба механизма связаны с конкретными пользователями через * группы <a href="#id1"><span id="id2" class="problematic">*</span></a>: пользователь принадлежит к любому количеству групп, а механизмы безопасности связаны с группами, таким образом применяя механизмы безопасности для пользователей.</p></section><section id="access-control"><i id="reference-security-acl"></i><h2 >Контроль доступа</h2><p >Управляется записями `` ir.model.access``, определяет доступ ко всей модели.</p><p >Каждый элемент управления доступом имеет модель, которой он предоставляет разрешения, разрешения, которые он предоставляет, и, необязательно, группу.</p><p >Контроль доступа является аддитивным, для данной модели пользователь имеет доступ ко всем разрешениям, предоставленным любой из его групп: если пользователь принадлежит к одной группе, которая разрешает запись, и другой, которая позволяет удалять, они могут как писать, так и удалять.</p><p >Если группа не указана, контроль доступа применяется ко всем пользователям, в противном случае он применяется только к членам данной группы.</p><p >Доступные разрешения: создание (`` perm_create``), поиск и чтение (`` perm_read``), обновление существующих записей (`` perm_write``) и удаление существующих записей (`` perm_unlink``)</p></section><section id="record-rules"><i id="reference-security-rules"></i><h2 >Правила записи</h2><p >Правила записи - это условия, которым записи должны удовлетворять для разрешения операции (создание, чтение, обновление или удаление). Применяется запись за записью после контроля доступа.</p><p >Правило записи имеет:</p><ul ><li >модель, на которую он распространяется</li><li >набор разрешений, к которым он применяется (например, если установлено `` perm_read``, правило будет проверяться только при чтении записи)</li><li >набор групп пользователей, к которым применяется правило, если группа не указана, правило является * глобальным *</li><li >a <span class="xref std std-ref">domain &lt;reference/orm/domains&gt;`используется для проверки того, соответствует ли данная запись правилу (и доступна ли она) или нет (и недоступна). Домен оценивается двумя переменными в контексте: `</span> user`` - это запись текущего пользователя, а `` time`` - это <a href="https://docs.python.org/3/library/time.html" class="external reference">time module</a></li></ul><p >Глобальные правила и правила групп (правила, ограниченные определенными группами по сравнению с группами, применяемыми ко всем пользователям) используются совершенно по-разному:</p><ul ><li >Глобальные правила являются вычитающими, они * должны все * совпадать, чтобы запись была доступна</li><li >Групповые правила являются аддитивными, если * любое * из них совпадает (и все глобальные правила совпадают), тогда запись доступна</li></ul><p >Это означает, что первое * групповое правило * ограничивает доступ, но любое дальнейшее * групповое правило * расширяет его, в то время как * глобальные правила * могут только когда-либо ограничивать доступ (или не иметь никакого эффекта).</p><div role="alert" class="aphorism alert-warning alert"><h3 class="alert-title">Предупреждение</h3><p >record rules do not apply to the Superuser account</p></div></section><section id="field-access"><i id="reference-security-fields"></i><h2 >Доступ к полю</h2><p >ORM <a href="orm.html#odoo.fields.Field" title="odoo.fields.Field" class="internal reference"><code class="py-class xref py">Field</code></a> может иметь атрибут` <code >groups`</code>, предоставляющий список групп (в виде разделенной запятыми строки: term:` external identifiers`).</p><p >Если текущий пользователь не входит ни в одну из перечисленных групп, он не будет иметь доступа к полю:</p><ul ><li >ограниченные поля автоматически удаляются из запрошенных просмотров</li><li >ограниченные поля удаляются из ответов <a href="orm.html#odoo.models.Model.fields_get" title="odoo.models.Model.fields_get" class="internal reference"><code class="py-meth xref py">fields_get()</code></a></li><li >попытки (явного) чтения или записи в ограниченные поля приводят к ошибке доступа</li></ul></section><section id="security-pitfalls"><i id="reference-security-pitfalls"></i><h2 >Security Pitfalls</h2><p >As a developer, it is important to understand the security mechanisms and avoid
common mistakes leading to insecure code.</p></section><section id="unsafe-public-methods"><h3 >Unsafe Public Methods</h3><p >Any public method can be executed via a <a href="../webservices/odoo.html#webservices-odoo-calling-methods" class="internal reference"><span class="std std-ref">RPC call</span></a> with the chosen parameters. The methods
starting with a <code >_</code> are not callable from an action button or external API.</p><p >On public methods, the record on which a method is executed and the parameters
can not be trusted, ACL being only verified during CRUD operations.</p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># this method is public and its arguments can not be trusted</span>
<span class="k">def</span> <span class="nf">action_done</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s2">&quot;draft&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_has_groups</span><span class="p">(</span><span class="s1">&#39;base.manager&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_state</span><span class="p">(</span><span class="s2">&quot;done&quot;</span><span class="p">)</span>

<span class="c1"># this method is private and can only be called from other python methods</span>
<span class="k">def</span> <span class="nf">_set_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_state</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sudo</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s2">&quot;state&quot;</span><span class="p">:</span> <span class="n">new_state</span><span class="p">})</span>
</pre></div>
</div>
<p >Making a method private is obviously not enough and care must be taken to use it
properly.</p></section><section id="bypassing-the-orm"><h3 >Bypassing the ORM</h3><p >You should never use the database cursor directly when the ORM can do the same
thing! By doing so you are bypassing all the ORM features, possibly the
automated behaviours like translations, invalidation of fields, <code >active</code>,
access rights and so on.</p><p >And chances are that you are also making the code harder to read and probably
less secure.</p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># very very wrong</span>
<span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">cr</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT id FROM auction_lots WHERE auction_id in (&#39;</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">ids</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;) AND state=</span><span class="si">%s</span><span class="s1"> AND obj_price &gt; 0&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;draft&#39;</span><span class="p">,))</span>
<span class="n">auction_lots_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">cr</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>

<span class="c1"># no injection, but still wrong</span>
<span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">cr</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT id FROM auction_lots WHERE auction_id in </span><span class="si">%s</span><span class="s1"> &#39;</span>\
           <span class="s1">&#39;AND state=</span><span class="si">%s</span><span class="s1"> AND obj_price &gt; 0&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">ids</span><span class="p">),</span> <span class="s1">&#39;draft&#39;</span><span class="p">,))</span>
<span class="n">auction_lots_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">cr</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>

<span class="c1"># better</span>
<span class="n">auction_lots_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;auction_id&#39;</span><span class="p">,</span><span class="s1">&#39;in&#39;</span><span class="p">,</span><span class="n">ids</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;state&#39;</span><span class="p">,</span><span class="s1">&#39;=&#39;</span><span class="p">,</span><span class="s1">&#39;draft&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;obj_price&#39;</span><span class="p">,</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)])</span>
</pre></div>
</div>
</section><section id="sql-injections"><h4 >SQL injections</h4><p >Care must be taken not to introduce SQL injections vulnerabilities when using
manual SQL queries. The vulnerability is present when user input is either
incorrectly filtered or badly quoted, allowing an attacker to introduce
undesirable clauses to a SQL query (such as circumventing filters or
executing <code >UPDATE</code> or <code >DELETE</code> commands).</p><p >The best way to be safe is to never, NEVER use Python string concatenation (+)
or string parameters interpolation (%) to pass variables to a SQL query string.</p><p >The second reason, which is almost as important, is that it is the job of the
database abstraction layer (psycopg2) to decide how to format query parameters,
not your job! For example psycopg2 knows that when you pass a list of values
it needs to format them as a comma-separated list, enclosed in parentheses !</p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># the following is very bad:</span>
<span class="c1">#   - it&#39;s a SQL injection vulnerability</span>
<span class="c1">#   - it&#39;s unreadable</span>
<span class="c1">#   - it&#39;s not your job to format the list of ids</span>
<span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">cr</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT distinct child_id FROM account_account_consol_rel &#39;</span> <span class="o">+</span>
           <span class="s1">&#39;WHERE parent_id IN (&#39;</span><span class="o">+</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">ids</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="p">)</span>

<span class="c1"># better</span>
<span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">cr</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT DISTINCT child_id &#39;</span>\
           <span class="s1">&#39;FROM account_account_consol_rel &#39;</span>\
           <span class="s1">&#39;WHERE parent_id IN </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span>
           <span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">ids</span><span class="p">),))</span>
</pre></div>
</div>
<p >This is very important, so please be careful also when refactoring, and most
importantly do not copy these patterns!</p><p >Here is a memorable example to help you remember what the issue is about (but
do not copy the code there). Before continuing, please be sure to read the
online documentation of pyscopg2 to learn of to use it properly:</p><ul ><li ><a href="http://initd.org/psycopg/docs/usage.html#the-problem-with-the-query-parameters" class="external reference">The problem with query parameters</a></li><li ><a href="http://initd.org/psycopg/docs/usage.html#passing-parameters-to-sql-queries" class="external reference">How to pass parameters with psycopg2</a></li><li ><a href="http://initd.org/psycopg/docs/usage.html#adaptation-of-python-values-to-sql-types" class="external reference">Advanced parameter types</a></li><li ><a href="https://www.psycopg.org/docs/sql.html" class="external reference">Psycopg documentation</a></li></ul></section><section id="unescaped-field-content"><h3 >Unescaped field content</h3><p >When rendering content using JavaScript and XML, one may be tempted to use
a <code >t-raw</code> to display rich-text content. This should be avoided as a frequent
<a href="https://en.wikipedia.org/wiki/Cross-site_scripting" class="external reference">XSS</a> vector.</p><p >It is very hard to control the integrity of the data from the computation until
the final integration in the browser DOM. A <code >t-raw</code> that is correctly escaped
at the time of introduction may no longer be safe at the next bugfix or
refactoring.</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">QWeb</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;insecure_template&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">info_message</span><span class="o">:</span> <span class="s2">&quot;You have an &lt;strong&gt;important&lt;/strong&gt; notification&quot;</span><span class="p">,</span>
<span class="p">})</span>
</pre></div>
</div>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;div</span> <span class="na">t-name=</span><span class="s">&quot;insecure_template&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;information-bar&quot;</span><span class="nt">&gt;&lt;t</span> <span class="na">t-raw=</span><span class="s">&quot;info_message&quot;</span> <span class="nt">/&gt;&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</div>
<p >The above code may feel safe as the message content is controlled but is a bad
practice that may lead to unexpected security vulnerabilities once this code
evolves in the future.</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="c1">// XSS possible with unescaped user provided content !</span>
<span class="nx">QWeb</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;insecure_template&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">info_message</span><span class="o">:</span> <span class="s2">&quot;You have an &lt;strong&gt;important&lt;/strong&gt; notification on &quot;</span> <span class="o">\</span>
        <span class="o">+</span> <span class="s2">&quot;the product &lt;strong&gt;&quot;</span> <span class="o">+</span> <span class="nx">product</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s2">&quot;&lt;/strong&gt;&quot;</span><span class="p">,</span>
<span class="p">})</span>
</pre></div>
</div>
<p >While formatting the template differently would prevent such vulnerabilities.</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">QWeb</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;secure_template&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">message</span><span class="o">:</span> <span class="s2">&quot;You have an important notification on the product:&quot;</span><span class="p">,</span>
    <span class="nx">subject</span><span class="o">:</span> <span class="nx">product</span><span class="p">.</span><span class="nx">name</span>
<span class="p">})</span>
</pre></div>
</div>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;div</span> <span class="na">t-name=</span><span class="s">&quot;secure_template&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;information-bar&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;info&quot;</span><span class="nt">&gt;&lt;t</span> <span class="na">t-esc=</span><span class="s">&quot;message&quot;</span> <span class="nt">/&gt;&lt;/div&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;subject&quot;</span><span class="nt">&gt;&lt;t</span> <span class="na">t-esc=</span><span class="s">&quot;subject&quot;</span> <span class="nt">/&gt;&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>
</div>
<div class="highlight-css"><div class="highlight"><pre><span></span><span class="p">.</span><span class="nc">subject</span> <span class="p">{</span>
    <span class="k">font-weight</span><span class="p">:</span> <span class="kc">bold</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section><section id="evaluating-content"><h3 >Evaluating content</h3><p >Some may want to <code >eval</code> to parse user provided content. Using <code >eval</code> should
be avoided at all cost. A safer, sandboxed, method <code class="py-class xref py">safe_eval</code>
can be used instead but still gives tremendous capabilities to the user running
it and must be reserved for trusted privileged users only as it breaks the
barrier between code and data.</p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># very bad</span>
<span class="n">domain</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filter_domain</span><span class="p">)</span>
<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span>

<span class="c1"># better but still not recommended</span>
<span class="kn">from</span> <span class="nn">odoo.tools</span> <span class="kn">import</span> <span class="n">safe_eval</span>
<span class="n">domain</span> <span class="o">=</span> <span class="n">safe_eval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filter_domain</span><span class="p">)</span>
<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span>

<span class="c1"># good</span>
<span class="kn">from</span> <span class="nn">ast</span> <span class="kn">import</span> <span class="n">literal_eval</span>
<span class="n">domain</span> <span class="o">=</span> <span class="n">literal_eval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filter_domain</span><span class="p">)</span>
<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span>
</pre></div>
</div>
<p >Parsing content does not need <code >eval</code></p><table class="table"><thead ><tr ><th >Language</th><th >Data type</th><th >Suitable parser</th></tr></thead><tbody ><tr ><td >Python</td><td >int, float, etc.</td><td >int(), float()</td></tr><tr ><td >Javascript</td><td >int, float, etc.</td><td >parseInt(), parseFloat()</td></tr><tr ><td >Python</td><td >dict</td><td >json.loads(), ast.literal_eval()</td></tr><tr ><td >Javascript</td><td >object, list, etc.</td><td >JSON.parse()</td></tr></tbody></table></section><section id="accessing-object-attributes"><h3 >Accessing object attributes</h3><p >If the values of a record needs to be retrieved or modified dynamically, one may
want to use the <code >getattr</code> and <code >setattr</code> methods.</p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># unsafe retrieval of a field value</span>
<span class="k">def</span> <span class="nf">_get_state_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">res_id</span><span class="p">,</span> <span class="n">state_field</span><span class="p">):</span>
    <span class="n">record</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sudo</span><span class="p">()</span><span class="o">.</span><span class="n">browse</span><span class="p">(</span><span class="n">res_id</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="n">state_field</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p >This code is however not safe as it allows to access any property of the record,
including private attributes or methods.</p><p >The <code >__getitem__</code> of a recordset has been defined and accessing a dynamic
field value can be easily achieved safely:</p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># better retrieval of a field value</span>
<span class="k">def</span> <span class="nf">_get_state_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">res_id</span><span class="p">,</span> <span class="n">state_field</span><span class="p">):</span>
    <span class="n">record</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sudo</span><span class="p">()</span><span class="o">.</span><span class="n">browse</span><span class="p">(</span><span class="n">res_id</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">record</span><span class="p">[</span><span class="n">state_field</span><span class="p">]</span>
</pre></div>
</div>
<p >The above method is obviously still too optimistic and additional verifications
on the record id and field value must be done.</p></section>

          </article>
        </div>
        
        <div id="mask"></div>
      </main>
  </div>

  <div class="floating_action_container">
    <a id="floating_action" class="ripple" href="#">
      <i class="mdi-action-explore"></i>
    </a>
    <div id="floating_action_menu">
      <span class="bubble"></span>
      <ul class="list-group content">
        <li class="list-group-item ripple"><a>Cras justo odio</a></li>
        <li class="list-group-item ripple"><a>Dapibus ac facilisis in</a></li>
        <li class="list-group-item ripple"><a>Morbi leo risus</a></li>
        <li class="list-group-item ripple"><a>Porta ac consectetur ac</a></li>
        <li class="list-group-item ripple"><a>Vestibulum at eros</a></li>
      </ul>
    </div>
  </div>
<!-- 
  <footer>
    <div id="footer" class="container">
      <span class="o_logo o_logo_inverse center-block o_footer_logo"></span>
      <div class="row">
        <div class="col-sm-7 col-md-7 col-lg-6">
          <div class="row">
            <div class="col-xs-6 col-sm-4">
              <span class="menu_title">Community</span>
              <ul>
                <li><a href="https://github.com/odoo/odoo">Github</a></li>
                <li><a href="http://www.odoo.com/page/download">Download</a></li>
                <li class="divider"></li>
                <li><a href="http://runbot.odoo.com/runbot/repo/git-github-com-odoo-enterprise-7">Runbot</a></li>
                <li><a href="https://github.com/odoo/odoo/wiki/Translations">Translations</a></li>
                <li class="divider"></li>
                <li><a href="http://www.odoo.com/page/odoo-community">Mailing Lists</a></li>
                <li><a href="http://www.odoo.com/forum/help-1">Forum</a></li>
              </ul>
            </div>
            <div class="col-xs-6 col-sm-4">
              <span class="menu_title">Services</span>
              <ul>
                <li><a href="https://www.odoo.sh">Odoo Cloud Platform</a></li>
                <li class="divider"></li>
                <li><a href="http://www.odoo.com/help">Support</a></li>
                <li><a href="https://upgrade.odoo.com">Upgrade</a></li>
                <li class="divider"></li>
                <li><a href="http://www.odoo.com/partners">Find a partner</a></li>
                <li><a href="http://www.odoo.com/page/become-a-partner">Become a partner</a></li>
                <li class="divider"></li>
                <li><a href="http://training.odoo.com/courses/odoo-functional">Training Center</a></li>
                <li><a href="http://www.odoo.com/page/education-program">Education</a></li>
                <li class="divider"></li>
                <li><a href="http://www.odoo.com/page/security">Security</a></li>
              </ul>
            </div>
            <div class="col-xs-12 col-sm-4 mb64">
              <span class="menu_title">About us</span>
              <ul>
                <li><a href="http://www.odoo.com/page/about-us">Our company</a></li>
                <li><a href="http://www.odoo.com/page/contactus">Contact</a></li>
                <li class="divider" />
                <li><a href="http://www.odoo.com/event">Events</a></li>
                <li><a href="http://www.odoo.com/blog">Blog</a></li>
                <li><a href="http://www.odoo.com/blog/6">Customers</a></li>
                <li class="divider" />
                <li><a href="http://www.odoo.com/jobs">Jobs</a></li>
                <li class="divider" />
                <li><a href="http://www.odoo.com/page/legal">Legal</a> | <a href="http://www.odoo.com/privacy">Privacy</a></li>
              </ul>
            </div>
          </div>
        </div>
        <div class="col-sm-5 col-md-4 col-md-offset-1 col-lg-5 col-lg-offset-1">
          <p>
            <small>
              Odoo is a suite of open source business apps that cover all your company needs: CRM, eCommerce, accounting, inventory, point of sale, project management, etc.
              <br/><br/>
              Odoo's unique value proposition is to be at the same time very easy to use and fully integrated.
            </small>
          </p>
        </div>
      </div>
    </div>
    <div class="o_footer_bottom">
      <div class="container">
        <a class="small" href="http://www.odoo.com/page/website-builder">Website made with <span class="o_logo o_logo_inverse o_logo_15"></span></a>
        <div class="social-links pull-right">
          <a href="http://www.odoo.com/web/about/facebook"><i class="fa fa-facebook"></i></a>
          <a href="http://www.odoo.com/web/about/twitter"><i class="fa fa-twitter"></i></a>
          <a href="http://www.odoo.com/web/about/linkedin"><i class="fa fa-linkedin"></i></a>
          <a href="mailto:info@odoo.com"><i class="fa fa-envelope"></i></a>
        </div>
      </div>
    </div>
  </footer>
  -->
  </body>
</html>