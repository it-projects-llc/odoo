<!doctype html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="ru">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css?family=Work+Sans:500,600" rel="stylesheet">
  
    <title>Testing Odoo &#8212; Документация odoo 13.0</title>
    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/patchqueue.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script type="text/javascript" src="../_static/jquery.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap.js"></script>
    <script type="text/javascript" src="../_static/doc.js"></script>
    <script type="text/javascript" src="../_static/jquery.noconflict.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <script type="text/javascript" src="../_static/patchqueue.js"></script><link rel="canonical" href="" />
  
    <link rel="index" title="Алфавитный указатель" href="../genindex.html" />
    <link rel="search" title="Поиск" href="../search.html" />
    <link rel="next" title="Web Controllers" href="http.html" />
    <link rel="prev" title="Security in Odoo" href="security.html" /> 
  </head><body><header class="o_main_header o_has_sub_nav o_inverted ">
    <div class="o_main_header_main">
      <a class="pull-left o_logo" href="/"></a>
      <a href="#" class="o_mobile_menu_toggle visible-xs-block pull-right">
        <span class="sr-only">Toggle navigation</span>
        <span class="mdi-navigation-menu"></span>
      </a>
      <div class="o_header_buttons">
        <a href="http://www.odoo.com/trial" class="btn btn-primary">Start Now</a>
      </div>
      <ul class="o_primary_nav">
        <li class="dropdown">
          <a href="#" class="dropdown-toggle">Apps</a>
          <div class="dropdown-menu o_secondary_nav">
            <div class="container">
              <div class="row">
                <div class="col-sm-3 o_website_apps">
                  <div class="o_nav_app_family">
                    <span></span> Websites
                    <div>Build great user experience</div>
                  </div>
                  <ul>
                    <li><a href="https://www.odoo.com/page/website-builder">Website Builder</a></li>
                    <li><a href="https://www.odoo.com/page/e-commerce">eCommerce</a></li>
                    <li><a href="https://www.odoo.com/page/blog-engine">Blogs</a></li>
                    <li><a href="https://www.odoo.com/page/community-builder">Forums</a></li>
                    <li><a href="https://www.odoo.com/page/slides">Slides</a></li>
                    <li><a href="https://adspike.odoo.com">SEA</a></li>
                  </ul>
                </div>
                <div class="col-sm-3 o_sale_apps">
                  <div class="o_nav_app_family">
                    <span></span> Sales
                    <div>Boost your success rate</div>
                  </div>
                  <ul>
                    <li><a href="https://www.odoo.com/page/sales">Sales</a></li>
                    <li><a href="https://www.odoo.com/page/crm">CRM</a></li>
                    <li><a href="https://www.odoo.com/page/billing">Invoicing</a></li>
                    <li class="dropdown">
                      <a href="#0" class="dropdown-toggle">Point of Sale</a>
                      <ul>
                        <li><a href="https://www.odoo.com/page/point-of-sale">Shops</a></li>
                        <li><a href="https://www.odoo.com/page/pos-restaurant">Restaurants</a></li>
                      </ul>
                    </li>
                    <li><a href="https://www.odoo.com/page/subscriptions">Subscriptions</a></li>
                    <li><a href="https://www.odoo.com/page/sign">Sign</a></li>
                  </ul>
                </div>
                <div class="col-sm-3 o_operation_apps">
                  <div class="o_nav_app_family">
                    <span></span> Operations
                    <div>It's all about efficiency</div>
                  </div>
                  <ul>
                    <li><a href="https://www.odoo.com/page/accounting">Accounting</a></li>
                    <li><a href="https://www.odoo.com/page/project-management">Project</a></li>
                    <li class="dropdown">
                      <a href="#0" class="dropdown-toggle">Human Resources</a>
                      <ul>
                        <li><a href="https://www.odoo.com/page/recruitment">Recruitment</a></li>
                        <li><a href="https://www.odoo.com/page/employees">Employees</a></li>
                        <li><a href="https://www.odoo.com/page/expenses">Expenses</a></li>
                        <li><a href="https://www.odoo.com/page/appraisal">Appraisal</a></li>
                        <li><a href="https://www.odoo.com/page/fleet">Fleet</a></li>
                        <li><a href="https://www.odoo.com/page/leaves">Leaves</a></li>
                      </ul>
                    </li>
                    <li><a href="https://www.odoo.com/page/warehouse">Inventory</a></li>
                    <li><a href="https://www.odoo.com/page/purchase">Purchase</a></li>
                    <li class="dropdown">
                      <a href="#0" class="dropdown-toggle">Manufacturing</a>
                      <ul>
                        <li><a href="https://www.odoo.com/page/manufacturing">MRP</a></li>
                        <li><a href="https://www.odoo.com/page/plm">PLM</a></li>
                        <li><a href="https://www.odoo.com/page/maintenance">Maintenance</a></li>
                        <li><a href="https://www.odoo.com/page/quality">Quality</a></li>
                      </ul>
                    </li>
                  </ul>
                </div>
                <div class="col-sm-3 o_productivity_apps">
                  <div class="o_nav_app_family">
                    <span></span> Productivity Tools
                    <div>Great Tools = Happy People</div>
                  </div>
                  <ul>
                    <li class="dropdown">
                      <a href="#0" class="dropdown-toggle">Communication</a>
                      <ul>
                        <li><a href="https://www.odoo.com/page/discuss">Discuss</a></li>
                        <li><a href="https://www.odoo.com/page/discuss-groups">Mailing Lists</a></li>
                        <li><a href="https://www.odoo.com/page/notes">Notes</a></li>
                        <li><a href="#">Help desk</a></li>
                        <li><a href="#">Appointment</a></li>
                      </ul>
                    </li>
                    <li><a href="https://www.odoo.com/page/timesheet">Timesheet</a></li>
                    <li><a href="https://www.odoo.com/page/email-marketing">Email Marketing</a></li>
                    <li><a href="https://www.odoo.com/page/events">Events</a></li>
                    <li><a href="https://www.odoo.com/page/survey">Survey</a></li>
                    <li><a href="https://www.odoo.com/page/live-chat">Live Chat</a></li>
                  </ul>
                </div>
              </div>
            </div>
            <a href="http://www.odoo.com/apps/modules" class="o_store_link"><i class="fa fa-cube fa-fw"></i> Third party apps</a>
          </div>
        </li>
        <li><a href="https://www.odoo.com/page/tour">Tour</a></li>
        <li><a href="https://www.odoo.com/pricing">Pricing</a></li>
        <li><a href="https://www.odoo.com/page/docs">Docs</a></li>
      </ul>
    </div>
    <nav class="navbar o_sub_nav">
      <div class="container">
        <div class="navbar-header visible-xs">
            <button type="button" class="navbar-toggle collapsed text-left btn-block" data-toggle="collapse" data-target="#o_sub-menu" aria-expanded="false">
              Navigate
              <span class="mdi-hardware-keyboard-arrow-down pull-right"></span>
            </button>
        </div>

        <div class="collapse navbar-collapse" id="o_sub-menu">
          <ol class="o_breadcrumb breadcrumb nav navbar-left">
              
              





    
        
            <li><a href="../index.html">Developer Doc</a></li>
        
    
    <li class="active"><a href="#">Testing Odoo</a></li>

              
          </ol>

          <div class="call-to-action navbar-right hidden-xs">
            <a href="http://www.odoo.com/trial" class="btn btn-primary">Start Now</a>
          </div>

          <ul class="navbar-nav navbar-right nav o_sub_nav_actions">
            
              <li class="divider"></li>
            

            
            


            
          </ul>

          <ul class="nav navbar-nav navbar-right">
            

            
            

<li><a href="https://www.odoo.com/documentation/user/13.0/index.html">User</a></li>
<li><a href="https://www.odoo.com/documentation/13.0/index.html">Developer</a></li>
<li><a href="https://www.odoo.com/documentation/13.0/setup/install.html">Installation</a></li>
<li><a href="https://odoo.com/slides">eLearning</a></li>
<li><a href="https://www.odoo.com/page/odoo-white-paper">White Papers</a></li>
<li><a href="https://www.odoo.com/page/legal">Legal</a></li>
            

            
          </ul>
        </div>
      </div>
    </nav>
  </header><div id="wrap" class="">
    
    
    
    <figure class="card top has_banner">
      <span class="card-img" style="background-image: url('../_static/banners/testing_modules.jpg');"></span>
      <div class="container text-center">
        <h1> Testing Odoo </h1>
      </div>
    </figure>
    
    
    
      <main class="container ">
        
        <div class="o_content row">
          
          <aside>
            <div class="navbar-aside text-center">
              <ul class="nav text-left list-group"><li class="list-group-item"><a href="#testing-python-code" class="reference ripple internal">Testing Python code</a><ul ><li class="list-group-item"><a href="#running-tests" class="reference ripple internal">Running tests</a></li><li class="list-group-item"><a href="#test-selection" class="reference ripple internal">Test selection</a><ul ><li class="list-group-item"><a href="#invocation" class="reference ripple internal">Invocation</a></li><li class="list-group-item"><a href="#special-tags" class="reference ripple internal">Special tags</a></li><li class="list-group-item"><a href="#examples" class="reference ripple internal">Examples</a></li></ul></li></ul></li><li class="list-group-item"><a href="#testing-js-code" class="reference ripple internal">Testing JS code</a><ul ><li class="list-group-item"><a href="#qunit-test-suite" class="reference ripple internal">Qunit test suite</a></li><li class="list-group-item"><a href="#testing-infrastructure" class="reference ripple internal">Testing Infrastructure</a></li><li class="list-group-item"><a href="#modularity-and-testing" class="reference ripple internal">Modularity and testing</a></li><li class="list-group-item"><a href="#adding-a-new-test-case" class="reference ripple internal">Adding a new test case</a></li><li class="list-group-item"><a href="#helper-functions-and-specialized-assertions" class="reference ripple internal">Helper functions and specialized assertions</a></li><li class="list-group-item"><a href="#best-practices" class="reference ripple internal">Best Practices</a></li><li class="list-group-item"><a href="#tips" class="reference ripple internal">Tips</a></li></ul></li><li class="list-group-item"><a href="#integration-testing" class="reference ripple internal">Integration Testing</a><ul ><li class="list-group-item"><a href="#screenshots-and-screencasts-during-browser-js-tests" class="reference ripple internal">Screenshots and screencasts during browser_js tests</a></li></ul></li></ul>
              
              <p class="gith-container"><a href="https://github.com/odoo/odoo/edit/13.0/doc/reference/testing.rst" class="gith-link">
                  Edit on GitHub
              </a></p>
              
            </div>
          </aside>
          
          <article class="doc-body ">
            
            
  <section id="testing-odoo"><i id="reference-testing"></i><p >There are many ways to test an application.  In Odoo, we have three kinds of
tests</p><ul ><li >Python unit tests (see <a href="#testing-python-code" class="reference internal">Testing Python code</a>): useful for testing model business logic</li><li >JS unit tests (see <a href="#testing-js-code" class="reference internal">Testing JS code</a>): useful to test the javascript code in isolation</li><li >Tours (see <a href="#integration-testing" class="reference internal">Integration Testing</a>): tours simulate a real situation. They ensures that the
python and the javascript parts properly talk to each other.</li></ul></section><section id="testing-python-code"><h2 >Testing Python code</h2><p >Odoo provides support for testing modules using unittest.</p><p >To write tests, simply define a <code >tests</code> sub-package in your module, it will
be automatically inspected for test modules. Test modules should have a name
starting with <code >test_</code> and should be imported from <code >tests/__init__.py</code>,
e.g.</p><div class="highlight-text"><div class="highlight"><pre><span></span>your_module
|-- ...
`-- tests
    |-- __init__.py
    |-- test_bar.py
    `-- test_foo.py
</pre></div>
</div>
<p >and <code >__init__.py</code> contains:</p><div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">test_foo</span><span class="p">,</span> <span class="n">test_bar</span>
</pre></div>
</div>
<div role="alert" class="alert-warning alert"><h3 class="alert-title">Предупреждение</h3><p >test modules which are not imported from <code >tests/__init__.py</code> will not be
run</p></div><p >The test runner will simply run any test case, as described in the official
<a href="https://docs.python.org/3/library/unittest.html" class="reference external">unittest documentation</a>, but Odoo provides a number of utilities and helpers
related to testing Odoo content (modules, mainly):</p><section class="code-class"><h6 id="odoo.tests.common.TransactionCase"><code><em >class </em>odoo.tests.common.TransactionCase(<em>methodName='runTest'</em>)<a href="https://github.com/odoo/odoo/blob/13.0/odoo/tests/common.py#L418" class="reference external alert-link"><span class="viewcode-link">[исходный код]</span></a></code></h6><p >TestCase in which each test method is run in its own transaction,
and with its own cursor. The transaction is rolled back and the cursor
is closed after each test.</p><section class="code-method"><h6 id="odoo.tests.common.TransactionCase.browse_ref"><code>browse_ref(<em>xid</em>)<a href="https://github.com/odoo/odoo/blob/13.0/odoo/tests/common.py#L234" class="reference external alert-link"><span class="viewcode-link">[исходный код]</span></a></code></h6><p >Returns a record object for the provided
<a href="../glossary.html#term-external-identifier" class="reference alert-link internal"><span class="std-term xref std">external identifier</span></a></p><div class="code-fields"><div class="code-field"><div class="code-field-name">Параметры</div><div class="code-field-body"><strong >xid</strong> – fully-qualified <a href="../glossary.html#term-external-identifier" class="reference alert-link internal"><span class="std-term xref std">external identifier</span></a>, in the form
<code class="samp"><em >module</em>.<em >identifier</em></code></div></div><div class="code-field"><div class="code-field-name">Raise</div><div class="code-field-body">ValueError if not found</div></div><div class="code-field"><div class="code-field-name">Результат</div><div class="code-field-body"><a href="orm.html#odoo.models.BaseModel" title="odoo.models.BaseModel" class="reference alert-link internal"><code class="xref py-class py">BaseModel</code></a></div></div></div></section><section class="code-method"><h6 id="odoo.tests.common.TransactionCase.ref"><code>ref(<em>xid</em>)<a href="https://github.com/odoo/odoo/blob/13.0/odoo/tests/common.py#L223" class="reference external alert-link"><span class="viewcode-link">[исходный код]</span></a></code></h6><p >Returns database ID for the provided <a href="../glossary.html#term-external-identifier" class="reference alert-link internal"><span class="std-term xref std">external identifier</span></a>,
shortcut for <code >get_object_reference</code></p><div class="code-fields"><div class="code-field"><div class="code-field-name">Параметры</div><div class="code-field-body"><strong >xid</strong> – fully-qualified <a href="../glossary.html#term-external-identifier" class="reference alert-link internal"><span class="std-term xref std">external identifier</span></a>, in the form
<code class="samp"><em >module</em>.<em >identifier</em></code></div></div><div class="code-field"><div class="code-field-name">Raise</div><div class="code-field-body">ValueError if not found</div></div><div class="code-field"><div class="code-field-name">Результат</div><div class="code-field-body">registered id</div></div></div></section></section><section class="code-class"><h6 id="odoo.tests.common.SingleTransactionCase"><code><em >class </em>odoo.tests.common.SingleTransactionCase(<em>methodName='runTest'</em>)<a href="https://github.com/odoo/odoo/blob/13.0/odoo/tests/common.py#L454" class="reference external alert-link"><span class="viewcode-link">[исходный код]</span></a></code></h6><p >TestCase in which all test methods are run in the same transaction,
the transaction is started with the first test method and rolled back at
the end of the last.</p><section class="code-method"><h6 id="odoo.tests.common.SingleTransactionCase.browse_ref"><code>browse_ref(<em>xid</em>)<a href="https://github.com/odoo/odoo/blob/13.0/odoo/tests/common.py#L234" class="reference external alert-link"><span class="viewcode-link">[исходный код]</span></a></code></h6><p >Returns a record object for the provided
<a href="../glossary.html#term-external-identifier" class="reference alert-link internal"><span class="std-term xref std">external identifier</span></a></p><div class="code-fields"><div class="code-field"><div class="code-field-name">Параметры</div><div class="code-field-body"><strong >xid</strong> – fully-qualified <a href="../glossary.html#term-external-identifier" class="reference alert-link internal"><span class="std-term xref std">external identifier</span></a>, in the form
<code class="samp"><em >module</em>.<em >identifier</em></code></div></div><div class="code-field"><div class="code-field-name">Raise</div><div class="code-field-body">ValueError if not found</div></div><div class="code-field"><div class="code-field-name">Результат</div><div class="code-field-body"><a href="orm.html#odoo.models.BaseModel" title="odoo.models.BaseModel" class="reference alert-link internal"><code class="xref py-class py">BaseModel</code></a></div></div></div></section><section class="code-method"><h6 id="odoo.tests.common.SingleTransactionCase.ref"><code>ref(<em>xid</em>)<a href="https://github.com/odoo/odoo/blob/13.0/odoo/tests/common.py#L223" class="reference external alert-link"><span class="viewcode-link">[исходный код]</span></a></code></h6><p >Returns database ID for the provided <a href="../glossary.html#term-external-identifier" class="reference alert-link internal"><span class="std-term xref std">external identifier</span></a>,
shortcut for <code >get_object_reference</code></p><div class="code-fields"><div class="code-field"><div class="code-field-name">Параметры</div><div class="code-field-body"><strong >xid</strong> – fully-qualified <a href="../glossary.html#term-external-identifier" class="reference alert-link internal"><span class="std-term xref std">external identifier</span></a>, in the form
<code class="samp"><em >module</em>.<em >identifier</em></code></div></div><div class="code-field"><div class="code-field-name">Raise</div><div class="code-field-body">ValueError if not found</div></div><div class="code-field"><div class="code-field-name">Результат</div><div class="code-field-body">registered id</div></div></div></section></section><section class="code-class"><h6 id="odoo.tests.common.SavepointCase"><code><em >class </em>odoo.tests.common.SavepointCase(<em>methodName='runTest'</em>)<a href="https://github.com/odoo/odoo/blob/13.0/odoo/tests/common.py#L482" class="reference external alert-link"><span class="viewcode-link">[исходный код]</span></a></code></h6><p >Similar to <a href="#odoo.tests.common.SingleTransactionCase" title="odoo.tests.common.SingleTransactionCase" class="reference alert-link internal"><code class="xref py-class py">SingleTransactionCase</code></a> in that all test methods
are run in a single transaction <em >but</em> each test case is run inside a
rollbacked savepoint (sub-transaction).</p><p >Useful for test cases containing fast tests but with significant database
setup common to all cases (complex in-db test data): <code class="py-meth xref py">setUpClass()</code>
can be used to generate db test data once, then all test cases use the
same data without influencing one another but without having to recreate
the test data either.</p></section><section class="code-class"><h6 id="odoo.tests.common.HttpCase"><code><em >class </em>odoo.tests.common.HttpCase(<em>methodName='runTest'</em>)<a href="https://github.com/odoo/odoo/blob/13.0/odoo/tests/common.py#L929" class="reference external alert-link"><span class="viewcode-link">[исходный код]</span></a></code></h6><p >Transactional HTTP TestCase with url_open and Chrome headless helpers.</p><section class="code-method"><h6 id="odoo.tests.common.HttpCase.browse_ref"><code>browse_ref(<em>xid</em>)<a href="https://github.com/odoo/odoo/blob/13.0/odoo/tests/common.py#L234" class="reference external alert-link"><span class="viewcode-link">[исходный код]</span></a></code></h6><p >Returns a record object for the provided
<a href="../glossary.html#term-external-identifier" class="reference alert-link internal"><span class="std-term xref std">external identifier</span></a></p><div class="code-fields"><div class="code-field"><div class="code-field-name">Параметры</div><div class="code-field-body"><strong >xid</strong> – fully-qualified <a href="../glossary.html#term-external-identifier" class="reference alert-link internal"><span class="std-term xref std">external identifier</span></a>, in the form
<code class="samp"><em >module</em>.<em >identifier</em></code></div></div><div class="code-field"><div class="code-field-name">Raise</div><div class="code-field-body">ValueError if not found</div></div><div class="code-field"><div class="code-field-name">Результат</div><div class="code-field-body"><a href="orm.html#odoo.models.BaseModel" title="odoo.models.BaseModel" class="reference alert-link internal"><code class="xref py-class py">BaseModel</code></a></div></div></div></section><section class="code-method"><h6 id="odoo.tests.common.HttpCase.phantom_js"><code>phantom_js(<em>url_path</em>, <em>code</em>, <em>ready=''</em>, <em>login=None</em>, <em>timeout=60</em>, <em>**kw</em>)<a href="https://github.com/odoo/odoo/blob/13.0/odoo/tests/common.py#L1037" class="reference external alert-link"><span class="viewcode-link">[исходный код]</span></a></code></h6><p >Test js code running in the browser
- optionnally log as „login“
- load page given by url_path
- wait for ready object to be available
- eval(code) inside the page</p><p >To signal success test do:
console.log(„test successful“)</p><p >To signal failure do:
console.error(„test failed“)</p><p >If neither are done before timeout test fails.</p></section><section class="code-method"><h6 id="odoo.tests.common.HttpCase.ref"><code>ref(<em>xid</em>)<a href="https://github.com/odoo/odoo/blob/13.0/odoo/tests/common.py#L223" class="reference external alert-link"><span class="viewcode-link">[исходный код]</span></a></code></h6><p >Returns database ID for the provided <a href="../glossary.html#term-external-identifier" class="reference alert-link internal"><span class="std-term xref std">external identifier</span></a>,
shortcut for <code >get_object_reference</code></p><div class="code-fields"><div class="code-field"><div class="code-field-name">Параметры</div><div class="code-field-body"><strong >xid</strong> – fully-qualified <a href="../glossary.html#term-external-identifier" class="reference alert-link internal"><span class="std-term xref std">external identifier</span></a>, in the form
<code class="samp"><em >module</em>.<em >identifier</em></code></div></div><div class="code-field"><div class="code-field-name">Raise</div><div class="code-field-body">ValueError if not found</div></div><div class="code-field"><div class="code-field-name">Результат</div><div class="code-field-body">registered id</div></div></div></section></section><section class="code-function"><h6 id="odoo.tests.common.tagged"><code>odoo.tests.common.tagged(<em>*tags</em>)<a href="https://github.com/odoo/odoo/blob/13.0/odoo/tests/common.py#L2055" class="reference external alert-link"><span class="viewcode-link">[исходный код]</span></a></code></h6><p >A decorator to tag BaseCase objects
Tags are stored in a set that can be accessed from a „test_tags“ attribute
A tag prefixed by „-„ will remove the tag e.g. to remove the „standard“ tag
By default, all Test classes from odoo.tests.common have a test_tags
attribute that defaults to „standard“ and also the module technical name
When using class inheritance, the tags are NOT inherited.</p></section><p >By default, tests are run once right after the corresponding module has been
installed. Test cases can also be configured to run after all modules have
been installed, and not run right after the module installation:</p><section class="code-function"><h6 id="odoo.tests.common.at_install"><code>odoo.tests.common.at_install(<em>flag</em>)<a href="https://github.com/odoo/odoo/blob/13.0/odoo/tests/common.py#L91" class="reference external alert-link"><span class="viewcode-link">[исходный код]</span></a></code></h6><p >Sets the at-install state of a test, the flag is a boolean specifying
whether the test should (<code >True</code>) or should not (<code >False</code>) run during
module installation.</p><p >By default, tests are run right after installing the module, before
starting the installation of the next module.</p><div class="deprecated"><p ><span class="versionmodified">Не рекомендуется, начиная с версии 12.0: </span><code >at_install</code> is now a flag, you can use <a href="#odoo.tests.common.tagged" title="odoo.tests.common.tagged" class="reference alert-link internal"><code class="xref py-func py">tagged()</code></a> to
add/remove it, although <code >tagged</code> only works on test classes</p></div></section><section class="code-function"><h6 id="odoo.tests.common.post_install"><code>odoo.tests.common.post_install(<em>flag</em>)<a href="https://github.com/odoo/odoo/blob/13.0/odoo/tests/common.py#L106" class="reference external alert-link"><span class="viewcode-link">[исходный код]</span></a></code></h6><p >Sets the post-install state of a test. The flag is a boolean
specifying whether the test should or should not run after a set of
module installations.</p><p >By default, tests are <em >not</em> run after installation of all modules in the
current installation set.</p><div class="deprecated"><p ><span class="versionmodified">Не рекомендуется, начиная с версии 12.0: </span><code >post_install</code> is now a flag, you can use <a href="#odoo.tests.common.tagged" title="odoo.tests.common.tagged" class="reference alert-link internal"><code class="xref py-func py">tagged()</code></a> to
add/remove it, although <code >tagged</code> only works on test classes</p></div></section><p >The most common situation is to use
<a href="#odoo.tests.common.TransactionCase" title="odoo.tests.common.TransactionCase" class="reference internal"><code class="xref py-class py">TransactionCase</code></a> and test a property of a model
in each method:</p><div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TestModelA</span><span class="p">(</span><span class="n">common</span><span class="o">.</span><span class="n">TransactionCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_some_action</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">record</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;model.a&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;field&#39;</span><span class="p">:</span> <span class="s1">&#39;value&#39;</span><span class="p">})</span>
        <span class="n">record</span><span class="o">.</span><span class="n">some_action</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">record</span><span class="o">.</span><span class="n">field</span><span class="p">,</span>
            <span class="n">expected_field_value</span><span class="p">)</span>

    <span class="c1"># other tests...</span>
</pre></div>
</div>
<div role="alert" class="alert-info alert"><h3 class="alert-title">Примечание</h3><p >Test methods must start with <code >test_</code></p></div><section class="code-class"><h6 id="odoo.tests.common.Form"><code><em >class </em>odoo.tests.common.Form(<em>recordp</em>, <em>view=None</em>)<a href="https://github.com/odoo/odoo/blob/13.0/odoo/tests/common.py#L1197" class="reference external alert-link"><span class="viewcode-link">[исходный код]</span></a></code></h6><p >Server-side form view implementation (partial)</p><p >Implements much of the «form view» manipulation flow, such that
server-side tests can more properly reflect the behaviour which would be
observed when manipulating the interface:</p><ul ><li >call default_get and the relevant onchanges on «creation»</li><li >call the relevant onchanges on setting fields</li><li >properly handle defaults &amp; onchanges around x2many fields</li></ul><p >Saving the form returns the created record if in creation mode.</p><p >Regular fields can just be assigned directly to the form, for
<a href="orm.html#odoo.fields.Many2one" title="odoo.fields.Many2one" class="reference alert-link internal"><code class="xref py-class py">Many2one</code></a> fields assign a singleton recordset:</p><div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># empty recordset =&gt; creation mode</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">Form</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;sale.order&#39;</span><span class="p">])</span>
<span class="n">f</span><span class="o">.</span><span class="n">partner_id</span> <span class="o">=</span> <span class="n">a_partner</span>
<span class="n">so</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p >When editing a record, using the form as a context manager to
automatically save it at the end of the scope:</p><div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">Form</span><span class="p">(</span><span class="n">so</span><span class="p">)</span> <span class="k">as</span> <span class="n">f2</span><span class="p">:</span>
    <span class="n">f2</span><span class="o">.</span><span class="n">payment_term_id</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;account.account_payment_term_15days&#39;</span><span class="p">)</span>
    <span class="c1"># f2 is saved here</span>
</pre></div>
</div>
<p >For <a href="orm.html#odoo.fields.Many2many" title="odoo.fields.Many2many" class="reference alert-link internal"><code class="xref py-class py">Many2many</code></a> fields, the field itself is a
<a href="#odoo.tests.common.M2MProxy" title="odoo.tests.common.M2MProxy" class="reference alert-link internal"><code class="xref py-class py">M2MProxy</code></a> and can be altered by adding or
removing records:</p><div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">Form</span><span class="p">(</span><span class="n">user</span><span class="p">)</span> <span class="k">as</span> <span class="n">u</span><span class="p">:</span>
    <span class="n">u</span><span class="o">.</span><span class="n">groups_id</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;account.group_account_manager&#39;</span><span class="p">))</span>
    <span class="n">u</span><span class="o">.</span><span class="n">groups_id</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">env</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;base.group_portal&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</pre></div>
</div>
<p >Finally <a href="orm.html#odoo.fields.One2many" title="odoo.fields.One2many" class="reference alert-link internal"><code class="xref py-class py">One2many</code></a> are reified as
<a href="#odoo.tests.common.O2MProxy" title="odoo.tests.common.O2MProxy" class="reference alert-link internal"><code class="xref py-class py">O2MProxy</code></a>.</p><p >Because the <a href="orm.html#odoo.fields.One2many" title="odoo.fields.One2many" class="reference alert-link internal"><code class="xref py-class py">One2many</code></a> only exists through its
parent, it is manipulated more directly by creating «sub-forms»
with the <a href="#odoo.tests.common.O2MProxy.new" title="odoo.tests.common.O2MProxy.new" class="reference alert-link internal"><code class="py-meth xref py">new()</code></a> and
<a href="#odoo.tests.common.O2MProxy.edit" title="odoo.tests.common.O2MProxy.edit" class="reference alert-link internal"><code class="py-meth xref py">edit()</code></a> methods. These would
normally be used as context managers since they get saved in the
parent record:</p><div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">Form</span><span class="p">(</span><span class="n">so</span><span class="p">)</span> <span class="k">as</span> <span class="n">f3</span><span class="p">:</span>
    <span class="c1"># add support</span>
    <span class="k">with</span> <span class="n">f3</span><span class="o">.</span><span class="n">order_line</span><span class="o">.</span><span class="n">new</span><span class="p">()</span> <span class="k">as</span> <span class="n">line</span><span class="p">:</span>
        <span class="n">line</span><span class="o">.</span><span class="n">product_id</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;product.product_product_2&#39;</span><span class="p">)</span>
    <span class="c1"># add a computer</span>
    <span class="k">with</span> <span class="n">f3</span><span class="o">.</span><span class="n">order_line</span><span class="o">.</span><span class="n">new</span><span class="p">()</span> <span class="k">as</span> <span class="n">line</span><span class="p">:</span>
        <span class="n">line</span><span class="o">.</span><span class="n">product_id</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;product.product_product_3&#39;</span><span class="p">)</span>
    <span class="c1"># we actually want 5 computers</span>
    <span class="k">with</span> <span class="n">f3</span><span class="o">.</span><span class="n">order_line</span><span class="o">.</span><span class="n">edit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">as</span> <span class="n">line</span><span class="p">:</span>
        <span class="n">line</span><span class="o">.</span><span class="n">product_uom_qty</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="c1"># remove support</span>
    <span class="n">f3</span><span class="o">.</span><span class="n">order_line</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1"># SO is saved here</span>
</pre></div>
</div>
<div class="code-fields"><div class="code-field"><div class="code-field-name">Параметры</div><div class="code-field-body"><ul ><li ><strong >recordp</strong> (<a href="orm.html#odoo.models.Model" title="odoo.models.Model" class="reference alert-link internal"><code >odoo.models.Model</code></a>) – empty or singleton recordset. An empty recordset will
put the view in «creation» mode and trigger calls to
default_get and on-load onchanges, a singleton will
put it in «edit» mode and only load the view’s data.</li><li ><strong >view</strong> (<code >int | str | odoo.model.Model</code>) – the id, xmlid or actual view object to use for
onchanges and view constraints. If none is provided,
simply loads the default view for the model.</li></ul></div></div></div><div class="versionadded"><p ><span class="versionmodified">Добавлено в версии 12.0.</span></p></div><section class="code-method"><h6 id="odoo.tests.common.Form.save"><code>save()<a href="https://github.com/odoo/odoo/blob/13.0/odoo/tests/common.py#L1545" class="reference external alert-link"><span class="viewcode-link">[исходный код]</span></a></code></h6><p >Saves the form, returns the created record if applicable</p><ul ><li >does not save <code >readonly</code> fields</li><li >does not save unmodified fields (during edition) — any assignment
or onchange return marks the field as modified, even if set to its
current value</li></ul><div class="code-fields"><div class="code-field"><div class="code-field-name">Исключение</div><div class="code-field-body"><a href="https://docs.python.org/3/library/exceptions.html#AssertionError" title="(в Python v3.8)" class="reference external alert-link"><strong >AssertionError</strong></a> – if the form has any unfilled required field</div></div></div></section></section><section class="code-class"><h6 id="odoo.tests.common.M2MProxy"><code><em >class </em>odoo.tests.common.M2MProxy<a href="https://github.com/odoo/odoo/blob/13.0/odoo/tests/common.py#L1938" class="reference external alert-link"><span class="viewcode-link">[исходный код]</span></a></code></h6><p >Behaves as a <code class="xref py-class py">Sequence</code> of recordsets, can be
indexed or sliced to get actual underlying recordsets.</p><section class="code-method"><h6 id="odoo.tests.common.M2MProxy.add"><code>add(<em>record</em>)<a href="https://github.com/odoo/odoo/blob/13.0/odoo/tests/common.py#L1967" class="reference external alert-link"><span class="viewcode-link">[исходный код]</span></a></code></h6><p >Adds <code >record</code> to the field, the record must already exist.</p><p >The addition will only be finalized when the parent record is saved.</p></section><section class="code-method"><h6 id="odoo.tests.common.M2MProxy.clear"><code>clear()<a href="https://github.com/odoo/odoo/blob/13.0/odoo/tests/common.py#L2004" class="reference external alert-link"><span class="viewcode-link">[исходный код]</span></a></code></h6><p >Removes all existing records in the m2m</p></section><section class="code-method"><h6 id="odoo.tests.common.M2MProxy.remove"><code>remove(<em>id=None</em>, <em>index=None</em>)<a href="https://github.com/odoo/odoo/blob/13.0/odoo/tests/common.py#L1987" class="reference external alert-link"><span class="viewcode-link">[исходный код]</span></a></code></h6><p >Removes a record at a certain index or with a provided id from
the field.</p></section></section><section class="code-class"><h6 id="odoo.tests.common.O2MProxy"><code><em >class </em>odoo.tests.common.O2MProxy<a href="https://github.com/odoo/odoo/blob/13.0/odoo/tests/common.py#L1836" class="reference external alert-link"><span class="viewcode-link">[исходный код]</span></a></code></h6><section class="code-method"><h6 id="odoo.tests.common.O2MProxy.edit"><code>edit(<em>index</em>)<a href="https://github.com/odoo/odoo/blob/13.0/odoo/tests/common.py#L1903" class="reference external alert-link"><span class="viewcode-link">[исходный код]</span></a></code></h6><p >Returns a <a href="#odoo.tests.common.Form" title="odoo.tests.common.Form" class="reference alert-link internal"><code class="xref py-class py">Form</code></a> to edit the pre-existing
<a href="orm.html#odoo.fields.One2many" title="odoo.fields.One2many" class="reference alert-link internal"><code class="xref py-class py">One2many</code></a> record.</p><p >The form is created from the list view if editable, or the field’s
form view otherwise.</p><div class="code-fields"><div class="code-field"><div class="code-field-name">Исключение</div><div class="code-field-body"><a href="https://docs.python.org/3/library/exceptions.html#AssertionError" title="(в Python v3.8)" class="reference external alert-link"><strong >AssertionError</strong></a> – if the field is not editable</div></div></div></section><section class="code-method"><h6 id="odoo.tests.common.O2MProxy.new"><code>new()<a href="https://github.com/odoo/odoo/blob/13.0/odoo/tests/common.py#L1891" class="reference external alert-link"><span class="viewcode-link">[исходный код]</span></a></code></h6><p >Returns a <a href="#odoo.tests.common.Form" title="odoo.tests.common.Form" class="reference alert-link internal"><code class="xref py-class py">Form</code></a> for a new
<a href="orm.html#odoo.fields.One2many" title="odoo.fields.One2many" class="reference alert-link internal"><code class="xref py-class py">One2many</code></a> record, properly initialised.</p><p >The form is created from the list view if editable, or the field’s
form view otherwise.</p><div class="code-fields"><div class="code-field"><div class="code-field-name">Исключение</div><div class="code-field-body"><a href="https://docs.python.org/3/library/exceptions.html#AssertionError" title="(в Python v3.8)" class="reference external alert-link"><strong >AssertionError</strong></a> – if the field is not editable</div></div></div></section><section class="code-method"><h6 id="odoo.tests.common.O2MProxy.remove"><code>remove(<em>index</em>)<a href="https://github.com/odoo/odoo/blob/13.0/odoo/tests/common.py#L1915" class="reference external alert-link"><span class="viewcode-link">[исходный код]</span></a></code></h6><p >Removes the record at <code >index</code> from the parent form.</p><div class="code-fields"><div class="code-field"><div class="code-field-name">Исключение</div><div class="code-field-body"><a href="https://docs.python.org/3/library/exceptions.html#AssertionError" title="(в Python v3.8)" class="reference external alert-link"><strong >AssertionError</strong></a> – if the field is not editable</div></div></div></section></section></section><section id="running-tests"><h3 >Running tests</h3><p >Tests are automatically run when installing or updating modules if
<a href="cmdline.html#cmdoption-odoo-bin-test-enable" class="reference internal"><code class="std-option xref std">--test-enable</code></a> was enabled when starting the
Odoo server.</p></section><section id="test-selection"><h3 >Test selection</h3><p >In Odoo, Python tests can be tagged to facilitate the test selection when
running tests.</p><p >Subclasses of <code class="xref py-class py">odoo.tests.common.BaseCase</code> (usually through
<a href="#odoo.tests.common.TransactionCase" title="odoo.tests.common.TransactionCase" class="reference internal"><code class="xref py-class py">TransactionCase</code></a>,
<a href="#odoo.tests.common.SavepointCase" title="odoo.tests.common.SavepointCase" class="reference internal"><code class="xref py-class py">SavepointCase</code></a> or
<a href="#odoo.tests.common.HttpCase" title="odoo.tests.common.HttpCase" class="reference internal"><code class="xref py-class py">HttpCase</code></a>) are automatically tagged with
<code >standard</code>, <code >at_install</code> and their source module’s name by default.</p></section><section id="invocation"><h4 >Invocation</h4><p ><a href="cmdline.html#cmdoption-odoo-bin-test-tags" class="reference internal"><code class="std-option xref std">--test-tags</code></a> can be used to select/filter tests
to run on the command-line.</p><p >This option defaults to <code >+standard</code> meaning tests tagged <code >standard</code>
(explicitly or implicitly) will be run by default when starting Odoo
with <a href="cmdline.html#cmdoption-odoo-bin-test-enable" class="reference internal"><code class="std-option xref std">--test-enable</code></a>.</p><p >When writing tests, the <a href="#odoo.tests.common.tagged" title="odoo.tests.common.tagged" class="reference internal"><code class="xref py-func py">tagged()</code></a> decorator can be
used on <strong >test classes</strong> to add or remove tags.</p><p >The decorator’s arguments are tag names, as strings.</p><div role="alert" class="alert-danger alert"><h3 class="alert-title">Опасно</h3><p ><a href="#odoo.tests.common.tagged" title="odoo.tests.common.tagged" class="reference alert-link internal"><code class="xref py-func py">tagged()</code></a> is a class decorator, it has no
effect on functions or methods</p></div><p >Tags can be prefixed with the minus (<code >-</code>) sign, to <em >remove</em> them instead of
add or select them e.g. if you don’t want your test to be executed by
default you can remove the <code >standard</code> tag:</p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">odoo.tests</span> <span class="kn">import</span> <span class="n">TransactionCase</span><span class="p">,</span> <span class="n">tagged</span>

<span class="nd">@tagged</span><span class="p">(</span><span class="s1">&#39;-standard&#39;</span><span class="p">,</span> <span class="s1">&#39;nice&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">NiceTest</span><span class="p">(</span><span class="n">TransactionCase</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p >This test will not be selected by default, to run it the relevant tag will
have to be selected explicitely:</p><div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> odoo-bin --test-enable --test-tags nice
</pre></div>
</div>
<p >Note that only the tests tagged <code >nice</code> are going to be executed. To run
<em >both</em> <code >nice</code> and <code >standard</code> tests, provide multiple values to
<a href="cmdline.html#cmdoption-odoo-bin-test-tags" class="reference internal"><code class="std-option xref std">--test-tags</code></a>: on the command-line, values
are <em >additive</em> (you’re selecting all tests with <em >any</em> of the specified tags)</p><div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> odoo-bin --test-enable --test-tags nice,standard
</pre></div>
</div>
<p >The config switch parameter also accepts the <code >+</code> and <code >-</code> prefixes. The
<code >+</code> prefix is implied and therefore, totaly optional. The <code >-</code> (minus)
prefix is made to deselect tests tagged with the prefixed tags, even if they
are selected by other specified tags e.g. if there are <code >standard</code> tests which
are also tagged as <code >slow</code> you can run all standard tests <em >except</em> the slow
ones:</p><div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> odoo-bin --test-enable --test-tags <span class="s1">&#39;standard,-slow&#39;</span>
</pre></div>
</div>
<p >When you write a test that does not inherit from the
<code class="xref py-class py">BaseCase</code>, this test will not have the default tags,
you have to add them explicitely to have the test included in the default test
suite.  This is a common issue when using a simple <code >unittest.TestCase</code> as
they’re not going to get run:</p><div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">odoo.tests</span> <span class="kn">import</span> <span class="n">tagged</span>

<span class="nd">@tagged</span><span class="p">(</span><span class="s1">&#39;standard&#39;</span><span class="p">,</span> <span class="s1">&#39;at_install&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">SmallTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
</section><section id="special-tags"><h4 >Special tags</h4><ul ><li ><p ><code >standard</code>: All Odoo tests that inherit from
<code class="xref py-class py">BaseCase</code> are implicitely tagged standard.
<a href="cmdline.html#cmdoption-odoo-bin-test-tags" class="reference internal"><code class="std-option xref std">--test-tags</code></a> also defaults to <code >standard</code>.</p><p >That means untagged test will be executed by default when tests are enabled.</p></li><li ><code >at_install</code>: Means that the test will be executed right after the module
installation and before other modules are installed. This is a default
implicit tag.</li><li ><p ><code >post_install</code>: Means that the test will be executed after all the modules
are installed. This is what you want for HttpCase tests most of the time.</p><p >Note that this is <em >not exclusive</em> with <code >at_install</code>, however since you
will generally not want both <code >post_install</code> is usually paired with
<code >-at_install</code> when tagging a test class.</p></li><li ><p ><em >module_name</em>: Odoo tests classes extending
<code class="xref py-class py">BaseCase</code> are implicitely tagged with the
technical name of their module. This allows easily selecting or excluding
specific modules when testing e.g. if you want to only run tests from
<code >stock_account</code>:</p><div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> odoo-bin --test-enable --test-tags stock_account
</pre></div>
</div>
</li></ul></section><section id="examples"><h4 >Examples</h4><div role="alert" class="alert-warning alert"><h3 class="alert-title">Важно</h3><p >Tests will be executed only in the installed or updated modules.  So
modules have to be selected with the <a href="cmdline.html#cmdoption-odoo-bin-u" class="reference alert-link internal"><code class="std-option xref std">-u</code></a> or
<a href="cmdline.html#cmdoption-odoo-bin-i" class="reference alert-link internal"><code class="std-option xref std">-i</code></a> switches.  For simplicity, those switches are
not specified in the examples below.</p></div><p >Run only the tests from the sale module:</p><div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> odoo-bin --test-enable --test-tags sale
</pre></div>
</div>
<p >Run the tests from the sale module but not the ones tagged as slow:</p><div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> odoo-bin --test-enable --test-tags <span class="s1">&#39;sale,-slow&#39;</span>
</pre></div>
</div>
<p >Run only the tests from stock or tagged as slow:</p><div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> odoo-bin --test-enable --test-tags <span class="s1">&#39;-standard, slow, stock&#39;</span>
</pre></div>
</div>
<div role="alert" class="alert-info alert"><h3 class="alert-title">Примечание</h3><p ><code >-standard</code> is implicit (not required), and present for clarity</p></div></section><section id="testing-js-code"><h2 >Testing JS code</h2><p >Testing a complex system is an important safeguard to prevent regressions and to
guarantee that some basic functionality still works. Since Odoo has a non trivial
codebase in Javascript, it is necessary to test it. In this section, we will
discuss the practice of testing JS code in isolation: these tests stay in the
browser, and are not supposed to reach the server.</p></section><section id="qunit-test-suite"><h3 >Qunit test suite</h3><p >The Odoo framework uses the <a href="https://qunitjs.com/" class="reference external">QUnit</a> library testing framework as a test runner.
QUnit defines the concepts of <em >tests</em> and <em >modules</em> (a set of related tests),
and gives us a web based interface to execute the tests.</p><p >For example, here is what a pyUtils test could look like:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">QUnit</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">&#39;py_utils&#39;</span><span class="p">);</span>

<span class="nx">QUnit</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;simple arithmetic&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">assert</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">assert</span><span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">pyUtils</span><span class="p">.</span><span class="nx">py_eval</span><span class="p">(</span><span class="s2">&quot;1 + 2&quot;</span><span class="p">);</span>
    <span class="nx">assert</span><span class="p">.</span><span class="nx">strictEqual</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;should properly evaluate sum&quot;</span><span class="p">);</span>
    <span class="nx">result</span> <span class="o">=</span> <span class="nx">pyUtils</span><span class="p">.</span><span class="nx">py_eval</span><span class="p">(</span><span class="s2">&quot;42 % 5&quot;</span><span class="p">);</span>
    <span class="nx">assert</span><span class="p">.</span><span class="nx">strictEqual</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;should properly evaluate modulo operator&quot;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<p >The main way to run the test suite is to have a running Odoo server, then
navigate a web browser to <code >/web/tests</code>.  The test suite will then be executed
by the web browser Javascript engine.</p><img src="../_images/tests.png" class="center-block img-responsive"><p >The web UI has many useful features: it can run only some submodules, or
filter tests that match a string. It can show every assertions, failed or passed,
rerun specific tests, …</p><div role="alert" class="alert-warning alert"><h3 class="alert-title">Предупреждение</h3><p >While the test suite is running, make sure that:</p><ul ><li >your browser window is focused,</li><li >it is not zoomed in/out. It needs to have exactly 100% zoom level.</li></ul><p >If this is not the case, some tests will fail, without a proper explanation.</p></div></section><section id="testing-infrastructure"><h3 >Testing Infrastructure</h3><p >Here is a high level overview of the most important parts of the testing
infrastructure:</p><ul ><li >there is an asset bundle named <a href="https://github.com/odoo/odoo/blob/51ee0c3cb59810449a60dae0b086b49b1ed6f946/addons/web/views/webclient_templates.xml#L427" class="reference external">web.js_tests_assets</a>.  This bundle contains
the main code (assets common + assets backend), some libraries, the QUnit test
runner, and some additional helper code</li><li >another asset bundle, <a href="https://github.com/odoo/odoo/blob/51ee0c3cb59810449a60dae0b086b49b1ed6f946/addons/web/views/webclient_templates.xml#L509" class="reference external">web.qunit_suite</a>, contains all the tests (and the
js_tests_assets code).  Almost all the test files should be added to this
bundle</li><li >there is a <a href="https://github.com/odoo/odoo/blob/51ee0c3cb59810449a60dae0b086b49b1ed6f946/addons/web/controllers/main.py#L637" class="reference external">controller</a> in web, mapped to the route <em >/web/tests</em>. This controller
simply renders the <em >web.qunit_suite</em> template.</li><li >to execute the tests, one can simply point its browser to the route <em >/web/tests</em>.
In that case, the browser will download all assets, and QUnit will take over.</li><li >there is some code in <a href="https://github.com/odoo/odoo/blob/51ee0c3cb59810449a60dae0b086b49b1ed6f946/addons/web/static/tests/helpers/qunit_config.js#L49" class="reference external">qunit_config.js</a> which logs in the console some
information when a test passes or fails.</li><li >we want the runbot to also run these tests, so there is a test (in <a href="https://github.com/odoo/odoo/blob/51ee0c3cb59810449a60dae0b086b49b1ed6f946/addons/web/tests/test_js.py#L13" class="reference external">test_js.py</a>)
which simply spawns a browser and points it to the <em >web/tests</em> url.  Note that
the phantom_js method does not spawn phantom_js, but Chrome headless instead.</li></ul></section><section id="modularity-and-testing"><h3 >Modularity and testing</h3><p >With the way Odoo is designed, any addon can modify the behaviour of other parts
of the system.  For example, the <em >voip</em> addon can modify the <em >FieldPhone</em> widget
to use extra features.  This is not really good from the perspective of the
testing system, since this means that a test in the addon web will fail whenever
the voip addon is installed (note that the runbot runs the tests with all addons
installed).</p><p >At the same time, our testing sytem is good, because it can detect whenever
another module breaks some core functionality.  There is no complete solution to
this issue.  For now, we solve this on a case by case basis.</p><p >Usually, it is not a good idea to modify some other behaviour.  For our voip
example, it is certainly cleaner to add a new <em >FieldVOIPPhone</em> widget and
modify the few views that needs it.  This way, the <em >FieldPhone</em> widget is not
impacted, and both can be tested.</p></section><section id="adding-a-new-test-case"><h3 >Adding a new test case</h3><p >Let us assume that we are maintaining an addon <em >my_addon</em>, and that we
want to add a test for some javascript code (for example, some utility function
myFunction, located in <em >my_addon.utils</em>). The process to add a new test case is
the following:</p><ol ><li ><p >create a new file <em >my_addon/static/tests/utils_tests.js</em>. This file contains the basic code to
add a QUnit module <em >my_addon &gt; utils</em>.</p><blockquote ><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">odoo</span><span class="p">.</span><span class="nx">define</span><span class="p">(</span><span class="s1">&#39;my_addon.utils_tests&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">require</span><span class="p">)</span> <span class="p">{</span>
<span class="s2">&quot;use strict&quot;</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">utils</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;my_addon.utils&#39;</span><span class="p">);</span>

<span class="nx">QUnit</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">&#39;my_addon&#39;</span><span class="p">,</span> <span class="p">{},</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="nx">QUnit</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">&#39;utils&#39;</span><span class="p">);</span>

<span class="p">});</span>
<span class="p">});</span>
</pre></div>
</div>
</blockquote></li><li ><p >In <em >my_addon/assets.xml</em>, add the file to the main test assets:</p><blockquote ><div class="highlight-xml"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="nt">&lt;odoo&gt;</span>
    <span class="nt">&lt;template</span> <span class="na">id=</span><span class="s">&quot;qunit_suite&quot;</span> <span class="na">name=</span><span class="s">&quot;my addon tests&quot;</span> <span class="na">inherit_id=</span><span class="s">&quot;web.qunit_suite&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;xpath</span> <span class="na">expr=</span><span class="s">&quot;//script[last()]&quot;</span> <span class="na">position=</span><span class="s">&quot;after&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;script</span> <span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">src=</span><span class="s">&quot;/my_addon/static/tests/utils_tests.js&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/xpath&gt;</span>
    <span class="nt">&lt;/template&gt;</span>
<span class="nt">&lt;/odoo&gt;</span>
</pre></div>
</div>
</blockquote></li><li >Restart the server and update <em >my_addon</em>, or do it from the interface (to
make sure the new test file is loaded)</li><li ><p >Add a test case after the definition of the <em >utils</em> sub test suite:</p><blockquote ><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">QUnit</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="s2">&quot;some test case that we want to test&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">assert</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">assert</span><span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">utils</span><span class="p">.</span><span class="nx">myFunction</span><span class="p">(</span><span class="nx">someArgument</span><span class="p">);</span>
    <span class="nx">assert</span><span class="p">.</span><span class="nx">strictEqual</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="nx">expectedResult</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
</blockquote></li><li >Visit <em >/web/tests/</em> to make sure the test is executed</li></ol></section><section id="helper-functions-and-specialized-assertions"><h3 >Helper functions and specialized assertions</h3><p >Without help, it is quite difficult to test some parts of Odoo. In particular,
views are tricky, because they communicate with the server and may perform many
rpcs, which needs to be mocked.  This is why we developed some specialized
helper functions, located in <a href="https://github.com/odoo/odoo/blob/51ee0c3cb59810449a60dae0b086b49b1ed6f946/addons/web/static/tests/helpers/test_utils.js" class="reference external">test_utils.js</a>.</p><ul ><li >Mock test functions: these functions help setting up a test environment. The
most important use case is mocking the answers given by the Odoo server. These
functions use a <a href="https://github.com/odoo/odoo/blob/51ee0c3cb59810449a60dae0b086b49b1ed6f946/addons/web/static/tests/helpers/mock_server.js" class="reference external">mock server</a>. This is a javascript class that simulates
answers to the most common model methods: read, search_read, nameget, …</li><li >DOM helpers: useful to simulate events/actions on some specific target. For
example, testUtils.dom.click performs a click on a target.  Note that it is
safer than doing it manually, because it also checks that the target exists,
and is visible.</li><li >create helpers: they are probably the most important functions exported by
<a href="https://github.com/odoo/odoo/blob/51ee0c3cb59810449a60dae0b086b49b1ed6f946/addons/web/static/tests/helpers/test_utils.js" class="reference external">test_utils.js</a>.  These helpers are useful to create a widget, with a mock
environment, and a lot of small detail to simulate as much as possible the
real conditions.  The most important is certainly <a href="https://github.com/odoo/odoo/blob/51ee0c3cb59810449a60dae0b086b49b1ed6f946/addons/web/static/tests/helpers/test_utils_create.js#L267" class="reference external">createView</a>.</li><li ><a href="https://github.com/odoo/odoo/blob/51ee0c3cb59810449a60dae0b086b49b1ed6f946/addons/web/static/tests/helpers/qunit_asserts.js" class="reference external">qunit assertions</a>: QUnit can be extended with specialized assertions. For
Odoo, we frequently test some DOM properties. This is why we made some
assertions to help with that.  For example, the <em >containsOnce</em> assertion takes
a widget/jQuery/HtmlElement and a selector, then checks if the target contains
exactly one match for the css selector.</li></ul><p >For example, with these helpers, here is what a simple form test could look like:</p><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="nx">QUnit</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;simple group rendering&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">assert</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">assert</span><span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">form</span> <span class="o">=</span> <span class="nx">testUtils</span><span class="p">.</span><span class="nx">createView</span><span class="p">({</span>
        <span class="nx">View</span><span class="o">:</span> <span class="nx">FormView</span><span class="p">,</span>
        <span class="nx">model</span><span class="o">:</span> <span class="s1">&#39;partner&#39;</span><span class="p">,</span>
        <span class="nx">data</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span>
        <span class="nx">arch</span><span class="o">:</span> <span class="s1">&#39;&lt;form string=&quot;Partners&quot;&gt;&#39;</span> <span class="o">+</span>
                <span class="s1">&#39;&lt;group&gt;&#39;</span> <span class="o">+</span>
                    <span class="s1">&#39;&lt;field name=&quot;foo&quot;/&gt;&#39;</span> <span class="o">+</span>
                <span class="s1">&#39;&lt;/group&gt;&#39;</span> <span class="o">+</span>
            <span class="s1">&#39;&lt;/form&gt;&#39;</span><span class="p">,</span>
        <span class="nx">res_id</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">});</span>

    <span class="nx">assert</span><span class="p">.</span><span class="nx">containsOnce</span><span class="p">(</span><span class="nx">form</span><span class="p">,</span> <span class="s1">&#39;table.o_inner_group&#39;</span><span class="p">);</span>

    <span class="nx">form</span><span class="p">.</span><span class="nx">destroy</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>
</div>
<p >Notice the use of the testUtils.createView helper and of the containsOnce
assertion.  Also, the form controller was properly destroyed at the end of
the test.</p></section><section id="best-practices"><h3 >Best Practices</h3><p >In no particular order:</p><ul ><li >all test files should be added in <em >some_addon/static/tests/</em></li><li >for bug fixes, make sure that the test fails without the bug fix, and passes
with it.  This ensures that it actually works.</li><li >try to have the minimal amount of code necessary for the test to work.</li><li >usually, two small tests are better than one large test.  A smaller test is
easier to understand and to fix.</li><li >always cleanup after a test.  For example, if your test instantiates a widget,
it should destroy it at the end.</li><li >no need to have full and complete code coverage.  But adding a few tests helps
a lot: it makes sure that your code is not completely broken, and whenever a
bug is fixed, it is really much easier to add a test to an existing test suite.</li><li >if you want to check some negative assertion (for example, that a HtmlElement
does not have a specific css class), then try to add the positive assertion in
the same test (for example, by doing an action that changes the state). This
will help avoid the test to become dead in the future (for example, if the css
class is changed).</li></ul></section><section id="tips"><h3 >Tips</h3><ul ><li >running only one test: you can (temporarily!) change the <em >QUnit.test(…)</em>
definition into <em >QUnit.only(…)</em>.  This is useful to make sure that QUnit
only runs this specific test.</li><li >debug flag: most create utility functions have a debug mode (activated by the
debug: true parameter).  In that case, the target widget will be put in the DOM
instead of the hidden qunit specific fixture, and more information will be
logged. For example, all mocked network communications will be available in the
console.</li><li >when working on a failing test, it is common to add the debug flag, then
comment the end of the test (in particular, the destroy call).  With this, it
is possible to see the state of the widget directly, and even better, to
manipulate the widget by clicking/interacting with it.</li></ul></section><section id="integration-testing"><h2 >Integration Testing</h2><p >Testing Python code and JS code separately is very useful, but it does not prove
that the web client and the server work together.  In order to do that, we can
write another kind of test: tours.  A tour is a mini scenario of some interesting
business flow.  It explains a sequence of steps that should be followed.  The
test runner will then create a phantom_js browser, point it to the proper url
and simulate the click and inputs, according to the scenario.</p></section><section id="screenshots-and-screencasts-during-browser-js-tests"><h3 >Screenshots and screencasts during browser_js tests</h3><p >When running tests that use HttpCase.browser_js from the command line, the Chrome
browser is used in headless mode. By default, if a test fails, a PNG screenshot is
taken at the moment of the failure and written in</p><div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">&#39;/tmp/odoo_tests/{db_name}/screenshots/&#39;</span>
</pre></div>
</div>
<p >Two new command line arguments were added since Odoo 13.0 to control this behavior:
<a href="cmdline.html#cmdoption-odoo-bin-screenshots" class="reference internal"><code class="std-option xref std">--screenshots</code></a> and <a href="cmdline.html#cmdoption-odoo-bin-screencasts" class="reference internal"><code class="std-option xref std">--screencasts</code></a></p></section>

          </article>
        </div>
        
        <div id="mask"></div>
      </main>
  </div>

  <div class="floating_action_container">
    <a id="floating_action" class="ripple" href="#">
      <i class="mdi-action-explore"></i>
    </a>
    <div id="floating_action_menu">
      <span class="bubble"></span>
      <ul class="list-group content">
        <li class="list-group-item ripple"><a>Cras justo odio</a></li>
        <li class="list-group-item ripple"><a>Dapibus ac facilisis in</a></li>
        <li class="list-group-item ripple"><a>Morbi leo risus</a></li>
        <li class="list-group-item ripple"><a>Porta ac consectetur ac</a></li>
        <li class="list-group-item ripple"><a>Vestibulum at eros</a></li>
      </ul>
    </div>
  </div>
  <footer>
    <div id="footer" class="container">
      <span class="o_logo o_logo_inverse center-block o_footer_logo"></span>
      <div class="row">
        <div class="col-sm-7 col-md-7 col-lg-6">
          <div class="row">
            <div class="col-xs-6 col-sm-4">
              <span class="menu_title">Community</span>
              <ul>
                <li><a href="https://github.com/odoo/odoo">Github</a></li>
                <li><a href="http://www.odoo.com/page/download">Download</a></li>
                <li class="divider"></li>
                <li><a href="http://runbot.odoo.com/runbot/repo/git-github-com-odoo-enterprise-7">Runbot</a></li>
                <li><a href="https://github.com/odoo/odoo/wiki/Translations">Translations</a></li>
                <li class="divider"></li>
                <li><a href="http://www.odoo.com/page/odoo-community">Mailing Lists</a></li>
                <li><a href="http://www.odoo.com/forum/help-1">Forum</a></li>
              </ul>
            </div>
            <div class="col-xs-6 col-sm-4">
              <span class="menu_title">Services</span>
              <ul>
                <li><a href="https://www.odoo.sh">Odoo Cloud Platform</a></li>
                <li class="divider"></li>
                <li><a href="http://www.odoo.com/help">Support</a></li>
                <li><a href="https://upgrade.odoo.com">Upgrade</a></li>
                <li class="divider"></li>
                <li><a href="http://www.odoo.com/partners">Find a partner</a></li>
                <li><a href="http://www.odoo.com/page/become-a-partner">Become a partner</a></li>
                <li class="divider"></li>
                <li><a href="http://training.odoo.com/courses/odoo-functional">Training Center</a></li>
                <li><a href="http://www.odoo.com/page/education-program">Education</a></li>
                <li class="divider"></li>
                <li><a href="http://www.odoo.com/page/security">Security</a></li>
              </ul>
            </div>
            <div class="col-xs-12 col-sm-4 mb64">
              <span class="menu_title">About us</span>
              <ul>
                <li><a href="http://www.odoo.com/page/about-us">Our company</a></li>
                <li><a href="http://www.odoo.com/page/contactus">Contact</a></li>
                <li class="divider" />
                <li><a href="http://www.odoo.com/event">Events</a></li>
                <li><a href="http://www.odoo.com/blog">Blog</a></li>
                <li><a href="http://www.odoo.com/blog/6">Customers</a></li>
                <li class="divider" />
                <li><a href="http://www.odoo.com/jobs">Jobs</a></li>
                <li class="divider" />
                <li><a href="http://www.odoo.com/page/legal">Legal</a> | <a href="http://www.odoo.com/privacy">Privacy</a></li>
              </ul>
            </div>
          </div>
        </div>
        <div class="col-sm-5 col-md-4 col-md-offset-1 col-lg-5 col-lg-offset-1">
          <p>
            <small>
              Odoo is a suite of open source business apps that cover all your company needs: CRM, eCommerce, accounting, inventory, point of sale, project management, etc.
              <br/><br/>
              Odoo's unique value proposition is to be at the same time very easy to use and fully integrated.
            </small>
          </p>
        </div>
      </div>
    </div>
    <div class="o_footer_bottom">
      <div class="container">
        <a class="small" href="http://www.odoo.com/page/website-builder">Website made with <span class="o_logo o_logo_inverse o_logo_15"></span></a>
        <div class="social-links pull-right">
          <a href="http://www.odoo.com/web/about/facebook"><i class="fa fa-facebook"></i></a>
          <a href="http://www.odoo.com/web/about/twitter"><i class="fa fa-twitter"></i></a>
          <a href="http://www.odoo.com/web/about/linkedin"><i class="fa fa-linkedin"></i></a>
          <a href="mailto:info@odoo.com"><i class="fa fa-envelope"></i></a>
        </div>
      </div>
    </div>
  </footer>
  </body>
</html>